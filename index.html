<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LISBOA √âLITE - V27 FINAL</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --bg: #0a0c14;
            --glass: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.08);
            --accent: #8b5cf6;
            --success: #10b981;
            --danger: #ef4444;
            --text: #ffffff;
            --input-focus: rgba(139, 92, 246, 0.2);
        }

        body {
            margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text);
            background-image: radial-gradient(circle at 50% -20%, #1e1b4b, transparent);
            min-height: 100vh; padding-bottom: 110px; -webkit-tap-highlight-color: transparent;
        }

        .header { text-align: center; padding: 30px 20px; }
        .logo { width: 90px; height: 90px; border-radius: 50%; border: 2px solid var(--accent); box-shadow: 0 0 20px rgba(139, 92, 246, 0.3); margin-bottom: 10px; object-fit: cover; }

        .container { padding: 0 15px; max-width: 480px; margin: auto; }

        /* Card Saldo */
        .balance-card {
            background: var(--glass); backdrop-filter: blur(20px); border: 1px solid var(--glass-border);
            padding: 25px; border-radius: 28px; text-align: center; margin-bottom: 20px;
        }
        .balance-val { font-size: 2.5rem; font-weight: 800; color: var(--success); text-shadow: 0 0 15px rgba(16, 185, 129, 0.2); }

        /* Grid 12 Fun√ß√µes */
        .menu-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 25px; }
        .menu-item {
            background: var(--glass); border: 1px solid var(--glass-border);
            padding: 15px 5px; border-radius: 18px; text-align: center; transition: 0.2s;
        }
        .menu-item:active { transform: scale(0.9); background: var(--accent); }
        .menu-item i { font-size: 1.2rem; color: var(--accent); margin-bottom: 5px; display: block; }
        .menu-item span { font-size: 0.55rem; text-transform: uppercase; font-weight: 700; opacity: 0.8; }
        .menu-item:active i { color: white; }

        /* Estilo Se√ß√µes e Inputs */
        .section { background: var(--glass); backdrop-filter: blur(20px); border: 1px solid var(--glass-border); padding: 20px; border-radius: 24px; display: none; animation: fadeIn 0.3s ease; }
        .active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        label { font-size: 0.7rem; color: var(--accent); font-weight: 800; letter-spacing: 1px; margin-left: 5px; }
        input, select, textarea {
            background: rgba(0,0,0,0.3); border: 1px solid var(--glass-border); color: white;
            padding: 15px; border-radius: 14px; width: 100%; box-sizing: border-box; margin: 6px 0 15px 0; font-size: 16px;
        }
        input:focus { border-color: var(--accent); background: var(--input-focus); outline: none; }

        .btn-main { background: var(--accent); color: white; padding: 16px; border-radius: 14px; border: none; font-weight: 700; width: 100%; cursor: pointer; margin-top: 5px; box-shadow: 0 8px 15px rgba(139, 92, 246, 0.2); }
        .btn-pdf { background: #f8fafc; color: #0f172a; margin-top: 10px; }
        .btn-whats { background: #22c55e; margin-top: 10px; }

        /* Lista de Itens */
        .item-row { background: rgba(255,255,255,0.02); padding: 15px; border-radius: 16px; margin-bottom: 10px; border-left: 4px solid var(--accent); display: flex; justify-content: space-between; align-items: center; }

        /* Navega√ß√£o */
        .nav-bar { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 400px; background: rgba(10,12,20,0.9); backdrop-filter: blur(20px); padding: 12px; border-radius: 25px; display: flex; justify-content: space-around; border: 1px solid var(--glass-border); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .nav-item { color: rgba(255,255,255,0.3); font-size: 1.3rem; transition: 0.3s; }
        .nav-item.active { color: var(--accent); transform: translateY(-3px); }
    </style>
</head>
<body>

<div class="header">
    <img src="B1BCC237-7C89-4142-8131-6DA05C2A2C61 2.png" class="logo">
    <div style="font-size: 0.7rem; font-weight: 900; letter-spacing: 3px; opacity: 0.6;">LISBOA √âLITE GRAND LUX</div>
</div>

<div class="container">
    <div id="sec-home" class="section active">
        <div class="balance-card">
            <small style="opacity: 0.5; font-weight: 700;">SALDO DISPON√çVEL</small>
            <div class="balance-val" id="res-lucro">R$ 0,00</div>
            <div style="display:flex; justify-content:space-between; margin-top:15px; border-top:1px solid var(--glass-border); padding-top:15px; font-size: 0.8rem;">
                <span>M√£o de Obra: <b id="res-mao" style="color:var(--accent)">R$ 0</b></span>
                <span>Contas: <b id="res-contas" style="color:var(--danger)">R$ 0</b></span>
            </div>
        </div>
        
        <div class="menu-grid">
            <div class="menu-item" onclick="nav('sec-oleo')"><i class="fas fa-oil-can"></i><span>√ìleo</span></div>
            <div class="menu-item" onclick="nav('sec-estoque')"><i class="fas fa-box"></i><span>Estoque</span></div>
            <div class="menu-item" onclick="nav('sec-tabela')"><i class="fas fa-tags"></i><span>Tabela</span></div>
            <div class="menu-item" onclick="nav('sec-ia')"><i class="fas fa-brain"></i><span>Gest√£o</span></div>
            <div class="menu-item" onclick="nav('sec-agenda')"><i class="fas fa-calendar"></i><span>Agenda</span></div>
            <div class="menu-item" onclick="nav('sec-compras')"><i class="fas fa-shopping-cart"></i><span>Compras</span></div>
            <div class="menu-item" onclick="nav('sec-check')"><i class="fas fa-clipboard-check"></i><span>Avarias</span></div>
            <div class="menu-item" onclick="nav('sec-taxa')"><i class="fas fa-percent"></i><span>Taxas</span></div>
        </div>
        <canvas id="chartFin" height="140"></canvas>
    </div>

    <div id="sec-add" class="section">
        <h3 style="margin-top:0">üî® Novo Registro</h3>
        <label>CLIENTE</label><input id="sNome" placeholder="Nome Completo">
        <label>PLACA</label><input id="sPlaca" placeholder="Moto" style="text-transform:uppercase">
        <label>WHATSAPP</label><input id="sCel" type="tel" placeholder="55119...">
        <label>M√ÉO DE OBRA (R$)</label><input id="sMao" type="number" placeholder="Seu ganho limpo">
        <label>PE√áAS (R$)</label><input id="sPec" type="number" placeholder="Custo de reposi√ß√£o">
        <label>OBSERVA√á√ÉO</label><textarea id="sObs" placeholder="Servi√ßo realizado..."></textarea>
        
        <button class="btn-main" onclick="salvarServico()">SALVAR NO CAIXA</button>
        <button class="btn-main btn-pdf" onclick="gerarPDF()">GERAR PDF PARA CLIENTE</button>
    </div>

    <div id="sec-hist" class="section">
        <h3>üìÇ Hist√≥rico</h3>
        <input id="query" placeholder="üîç Buscar por placa..." onkeyup="render()">
        <div id="render-hist"></div>
    </div>

    <div id="sec-money" class="section">
        <h3>üí∏ Pagar Contas</h3>
        <label>DESCRI√á√ÉO</label><input id="cDesc" placeholder="Luz, Aluguel, Almo√ßo...">
        <label>VALOR (R$)</label><input id="cVal" type="number">
        <button class="btn-main" style="background:var(--danger)" onclick="salvarConta()">PAGAR E DESCONTAR</button>
        <div id="render-contas" style="margin-top:20px"></div>
    </div>

    <div id="sec-ia" class="section">
        <h3>ü§ñ Analista de Gest√£o</h3>
        <div id="ia-box" class="item-row">Aguardando dados...</div>
        <button class="btn-main" onclick="analisarIA()">ANALISAR HOJE</button>
        <hr style="opacity:0.1; margin:20px 0">
        <button class="btn-main" style="background:#333" onclick="alert(btoa(JSON.stringify(db)))">GERAR C√ìDIGO BACKUP</button>
    </div>

    <div id="sec-oleo" class="section"><h3>üõ¢Ô∏è Retorno de √ìleo</h3><div id="render-oleo"></div></div>
    <div id="sec-estoque" class="section"><h3>üì¶ Estoque</h3><input id="eN" placeholder="Pe√ßa"><input id="eQ" type="number"><button class="btn-main" onclick="addObj('estoque','eN','eQ')">ADD</button><div id="render-estoque"></div></div>
    <div id="sec-tabela" class="section"><h3>üìã Tabela</h3><input id="tN"><input id="tV"><button class="btn-main" onclick="addObj('tabela','tN','tV')">ADD</button><div id="render-tabela"></div></div>

</div>

<div class="nav-bar">
    <div class="nav-item active" id="n-home" onclick="nav('sec-home')"><i class="fas fa-chart-pie"></i></div>
    <div class="nav-item" id="n-add" onclick="nav('sec-add')"><i class="fas fa-plus-circle"></i></div>
    <div class="nav-item" id="n-hist" onclick="nav('sec-hist')"><i class="fas fa-history"></i></div>
    <div class="nav-item" id="n-money" onclick="nav('sec-money')"><i class="fas fa-wallet"></i></div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('lisboa_grand_v27')) || { mao: 0, contas: 0, pecas_total: 0, servicos: [], despesas: [], estoque: [], tabela: [] };
    let chart;

    function save() { localStorage.setItem('lisboa_grand_v27', JSON.stringify(db)); render(); }
    
    function nav(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.getElementById('n-' + id.split('-')[1]).classList.add('active');
        window.scrollTo(0,0);
    }

    function salvarServico() {
        let m = parseFloat(sMao.value) || 0;
        let p = parseFloat(sPec.value) || 0;
        if(!m || !sNome.value) return alert("Nome e M√£o de Obra s√£o obrigat√≥rios!");
        db.mao += m; db.pecas_total += p;
        db.servicos.unshift({ n: sNome.value, p: sPlaca.value.toUpperCase(), v: m+p, m, p, obs: sObs.value, d: new Date().toLocaleDateString(), t: new Date().getTime() });
        save(); nav('sec-home');
        sNome.value=''; sPlaca.value=''; sMao.value=''; sPec.value=''; sObs.value='';
    }

    function gerarPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const m = sMao.value || 0;
        const p = sPec.value || 0;
        const total = parseFloat(m) + parseFloat(p);

        doc.setFontSize(20); doc.text("RECIBO OFICINA LISBOA", 20, 20);
        doc.setFontSize(12);
        doc.text(`Cliente: ${sNome.value}`, 20, 40);
        doc.text(`Moto/Placa: ${sPlaca.value.toUpperCase()}`, 20, 50);
        doc.text(`Data: ${new Date().toLocaleDateString()}`, 20, 60);
        doc.line(20, 65, 190, 65);
        doc.text(`M√£o de Obra: R$ ${parseFloat(m).toFixed(2)}`, 20, 80);
        doc.text(`Pe√ßas: R$ ${parseFloat(p).toFixed(2)}`, 20, 90);
        doc.setFontSize(16);
        doc.text(`TOTAL A PAGAR: R$ ${total.toFixed(2)}`, 20, 110);
        doc.setFontSize(10);
        doc.text(`Descri√ß√£o: ${sObs.value}`, 20, 130);
        doc.save(`Recibo_${sPlaca.value}.pdf`);
    }

    function salvarConta() {
        let v = parseFloat(cVal.value) || 0;
        if(!v) return;
        db.contas += v;
        db.despesas.unshift({ n: cDesc.value, v: v, d: new Date().toLocaleDateString() });
        cVal.value=''; cDesc.value=''; save();
    }

    function render() {
        let lucro = db.mao - db.contas;
        document.getElementById('res-lucro').innerText = "R$ " + lucro.toLocaleString('pt-BR',{minimumFractionDigits:2});
        document.getElementById('res-mao').innerText = "R$ " + db.mao.toFixed(2);
        document.getElementById('res-contas').innerText = "R$ " + db.contas.toFixed(2);

        document.getElementById('render-hist').innerHTML = db.servicos.filter(s => s.p.includes(query.value.toUpperCase())).map(s => `
            <div class="item-row"><div><b>${s.p}</b><br><small>${s.n}</small></div><b>R$ ${s.v.toFixed(2)}</b></div>
        `).join('');

        const ctx = document.getElementById('chartFin').getContext('2d');
        if(chart) chart.destroy();
        chart = new Chart(ctx, { type: 'line', data: { labels: ['','','','',''], datasets: [{ label: 'Lucro', data: [0, lucro*0.3, lucro*0.7, lucro], borderColor: '#8b5cf6', fill: true, backgroundColor: 'rgba(139, 92, 246, 0.1)', tension: 0.4 }] }, options: { plugins: { legend: { display: false } }, scales: { y: { display: false }, x: { display: false } } } });
    }

    function analisarIA() {
        let l = db.mao - db.contas;
        document.getElementById('ia-box').innerText = l > 0 ? "Voc√™ est√° com lucro de R$ "+l.toFixed(2)+". Bom trabalho!" : "Aten√ß√£o √†s despesas fixas!";
    }

    render();
</script>
</body>
</html>
