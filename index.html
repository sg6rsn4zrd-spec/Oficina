<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lisboa Pro - Oficina</title>

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>

<style>
:root{
  --bg:#0a0e17; --card:#161b28; --primary:#2a5ee8;
  --accent:#00d2ff; --success:#00f298; --danger:#ff4b5c; --text:#e1e8f0;
}
body{margin:0;font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);padding:20px;}
.header{text-align:center;padding:15px;background:var(--card);border-radius:12px;margin-bottom:20px;}
.header img{max-width:120px;}
.card{background:var(--card);border-radius:15px;padding:15px;margin-bottom:15px;}
input, select, textarea{width:100%;padding:12px;margin:8px 0;border-radius:10px;border:1px solid #2d364a;background:#0f141e;color:white;}
button{width:100%;padding:12px;border:none;border-radius:12px;background:var(--primary);color:white;font-weight:bold;margin-top:8px;cursor:pointer;transition:0.2s;}
button:active{opacity:0.8;}
.menu-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:20px;}
.menu-item{text-align:center;padding:10px;border-radius:12px;background:var(--card);cursor:pointer;transition:0.2s;}
.menu-item i{font-size:1.2rem;color:var(--accent);margin-bottom:6px;display:block;}
.menu-item span{font-size:0.6rem;font-weight:bold;}
.menu-item:hover{background:var(--primary);}
.section{display:none;}
.active{display:block;}
.balance-val{font-size:2rem;color:var(--success);margin:5px 0;}
.list-item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-left:4px solid var(--primary);margin-bottom:5px;border-radius:8px;background:rgba(255,255,255,0.05);}
.ia-box{background:#000;border:1px solid var(--success);padding:12px;border-radius:10px;font-family:'Courier New',monospace;color:var(--success);}
.badge{background:var(--danger);border-radius:50px;padding:2px 6px;font-size:10px;position:absolute;top:-5px;right:-5px;}
.toast{position:fixed;bottom:20px;right:20px;background:var(--accent);color:#000;padding:12px 20px;border-radius:12px;box-shadow:0 5px 15px rgba(0,0,0,0.3);opacity:0;pointer-events:none;transition:0.5s;}
.toast.show{opacity:1;pointer-events:auto;}
</style>
</head>
<body>

<div class="header">
  <img src="B1BCC237-7C89-4142-8131-6DA05C2A2C61 2.png" alt="Lisboa Pro">
</div>

<!-- LOGIN -->
<div id="loginPage" class="card">
  <h2>üîí Login Administrador</h2>
  <input id="senha" type="password" placeholder="Digite a senha">
  <button onclick="login()">ENTRAR</button>
  <p id="erro" style="color:red;text-align:center;"></p>
</div>

<!-- PAINEL PRINCIPAL -->
<div id="mainPage" style="display:none;">

  <!-- Resumo Financeiro -->
  <div class="card">
    <h3>Saldo (Lucro L√≠quido)</h3>
    <div class="balance-val" id="val-lucro">R$ 0</div>
    <div style="display:flex;justify-content:space-between;font-size:12px;">
      <span>M√£o de Obra: <b id="val-mao" style="color:var(--accent)">0</b></span>
      <span>Contas: <b id="val-contas" style="color:var(--danger)">0</b></span>
    </div>
  </div>

  <!-- Menu -->
  <div class="menu-grid">
    <div class="menu-item" onclick="nav('sec-dash')"><i class="fas fa-chart-line"></i><span>Dash</span></div>
    <div class="menu-item" onclick="nav('sec-serv')"><i class="fas fa-plus"></i><span>Novo</span></div>
    <div class="menu-item" onclick="nav('sec-contas')"><i class="fas fa-receipt"></i><span>Contas</span></div>
    <div class="menu-item" onclick="nav('sec-oleo')" style="position:relative">
      <i class="fas fa-oil-can"></i><span>√ìleo</span>
      <span id="notif-oleo" class="badge" style="display:none">0</span>
    </div>
    <div class="menu-item" onclick="nav('sec-ia')"><i class="fas fa-brain"></i><span>I.A</span></div>
  </div>

  <!-- DASHBOARD -->
  <div id="sec-dash" class="section active card">
    <h3>üìä Dashboard</h3>
    <canvas id="chartFin" height="200"></canvas>
    <button onclick="gerarPDF()">üìÑ Gerar Relat√≥rio PDF</button>
    <button onclick="resetMes()" style="background:red;">üîÑ Resetar Ganhos do M√™s</button>
  </div>

  <!-- NOVO SERVI√áO -->
  <div id="sec-serv" class="section card">
    <h3>üîß Novo Servi√ßo</h3>
    <input id="sNome" placeholder="Nome Cliente">
    <input id="sPlaca" placeholder="Placa">
    <input id="sCel" placeholder="Celular WhatsApp">
    <input id="sMao" type="number" placeholder="M√£o de Obra">
    <input id="sPec" type="number" placeholder="Pe√ßas">
    <select id="sOleo">
      <option value="nao">Troca de √ìleo? N√£o</option>
      <option value="sim">Sim - Avisar em 90 dias</option>
    </select>
    <button onclick="salvarServico()">üíæ Salvar Servi√ßo</button>
    <button onclick="zapOrcamento()">üì± Enviar Or√ßamento WhatsApp</button>
  </div>

  <!-- CONTAS -->
  <div id="sec-contas" class="section card">
    <h3>üí∏ Contas</h3>
    <input id="cDesc" placeholder="Descri√ß√£o">
    <input id="cVal" type="number" placeholder="Valor R$">
    <button onclick="salvarConta()">üí∞ Pagar Conta</button>
    <div id="lista-contas"></div>
  </div>

  <!-- √ìLEO -->
  <div id="sec-oleo" class="section card">
    <h3>üõ¢Ô∏è √ìleo - Lembretes</h3>
    <div id="lista-oleo">Nenhum alerta</div>
  </div>

  <!-- IA -->
  <div id="sec-ia" class="section card">
    <h3>ü§ñ Analista Inteligente</h3>
    <div id="ia-res" class="ia-box">Aguardando...</div>
    <button onclick="analisarIA()">Gerar Diagn√≥stico</button>
    <hr>
    <button onclick="gerarBackup()" style="background:#333;">Backup</button>
    <textarea id="txtBack" style="width:100%;height:60px;font-size:10px;"></textarea>
  </div>

</div>

<div id="toast" class="toast"></div>

<script>
// VARI√ÅVEIS
const loginPage = document.getElementById('loginPage');
const mainPage = document.getElementById('mainPage');
const sNome = document.getElementById('sNome');
const sPlaca = document.getElementById('sPlaca');
const sCel = document.getElementById('sCel');
const sMao = document.getElementById('sMao');
const sPec = document.getElementById('sPec');
const cVal = document.getElementById('cVal');
const cDesc = document.getElementById('cDesc');
const busca = document.getElementById('busca');
const txtBack = document.getElementById('txtBack');
const toastDiv = document.getElementById('toast');
let chart;

// BANCO DE DADOS
let db = JSON.parse(localStorage.getItem('lisboa_vfinal')) || {mao:0,contas:0,pecas:0,servicos:[],despesas:[]};

// FUN√á√ïES
function save(){ localStorage.setItem('lisboa_vfinal',JSON.stringify(db)); render(); }
function showToast(msg){ toastDiv.innerText=msg; toastDiv.classList.add('show'); setTimeout(()=>{toastDiv.classList.remove('show');},2000); }

// LOGIN
function login(){
  let s = document.getElementById('senha').value;
  if(s==="1234"){ loginPage.style.display="none"; mainPage.style.display="block"; render(); }
  else showToast("Senha incorreta!");
}

// NAVEGA√á√ÉO
function nav(id){ document.querySelectorAll('.section').forEach(s=>s.classList.remove('active')); document.getElementById(id).classList.add('active'); }

// SERVI√áO
function salvarServico(){
  let m=parseFloat(sMao.value)||0;
  let p=parseFloat(sPec.value)||0;
  if(m+p>0){
    db.mao+=m; db.pecas+=p;
    db.servicos.unshift({n:sNome.value||"Sem nome",p:sPlaca.value.toUpperCase(),v:m+p,m:m,pe:p,z:sCel.value||"",ol:sOleo.value||"nao",d:new Date().getTime()});
    sNome.value=sPlaca.value=sMao.value=sPec.value=sCel.value="";
    save(); showToast("Servi√ßo salvo!");
  }
}

// CONTAS
function salvarConta(){
  let v=parseFloat(cVal.value)||0;
  if(v>0){ db.contas+=v; db.despesas.unshift({n:cDesc.value||"Sem descri√ß√£o",v:v,d:new Date().toLocaleDateString()}); cVal.value=cDesc.value=""; save(); showToast("Conta registrada!"); }
}

// RENDER
function render(){
  let lucro = db.mao-db.contas;
  document.getElementById('val-lucro').innerText="R$ "+lucro.toFixed(2);
  document.getElementById('val-mao').innerText="R$ "+db.mao.toFixed(2);
  document.getElementById('val-contas').innerText="R$ "+db.contas.toFixed(2);

  // Contas
  document.getElementById('lista-contas').innerHTML=db.despesas.map(d=>`<div class="list-item"><span>${d.n}</span><b style="color:red">R$ ${d.v}</b></div>`).join('');

  // Gr√°fico
  const ctx = document.getElementById('chartFin')?.getContext('2d');
  if(ctx){
    if(chart) chart.destroy();
    chart=new Chart(ctx,{type:'doughnut',data:{labels:['Lucro','Contas','Pe√ßas'],datasets:[{data:[lucro>0?lucro:0,db.contas,db.pecas],backgroundColor:['#00f298','#ff4b5c','#00d2ff']}]},options:{plugins:{legend:{labels:{color:'white'}}}}});
  }
}

// IA
function analisarIA(){
  let lucro = db.mao-db.contas;
  let msg="";
  if(lucro<=0) msg="‚ö† ALERTA CR√çTICO: Gastos maiores que lucro!";
  else if(db.contas>db.mao*0.5) msg="‚ö† Aten√ß√£o: Contas acima de 50% do lucro.";
  else msg="‚úÖ Lucro saud√°vel: R$ "+lucro.toFixed(2);
  document.getElementById('ia-res').innerText=msg;
}

// PDF
function gerarPDF(){ const {jsPDF} = window.jspdf; const doc=new jsPDF(); doc.text("Relat√≥rio Lisboa Pro",10,10); doc.text(`Lucro: R$ ${db.mao-db.contas}`,10,20); doc.save("relatorio.pdf"); }

// RESET
function resetMes(){ if(confirm("Zerar ganhos do m√™s?")){ db.mao=0; db.contas=0; db.pecas=0; save(); } }

// OR√áAMENTO WhatsApp
function zapOrcamento(){ window.open(`https://api.whatsapp.com/send?phone=${encodeURIComponent(sCel.value.replace(/\D/g,''))}&text=Ol√°! Or√ßamento: M√£o de obra R$ ${sMao.value}, Pe√ßas R$ ${sPec.value}`); }

// BACKUP
function gerarBackup(){ txtBack.value=btoa(JSON.stringify(db)); }
</script>

</body>
</html>
