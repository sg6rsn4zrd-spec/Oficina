<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISTEMA MOTO & BIKE - LISBOA PRO</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        :root { --primary: #1b4a9c; --accent: #00b4ff; --success: #00ff9d; --danger: #ff4b2b; --dark: #0a192f; --card: #112240; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--dark); color: white; padding-bottom: 50px; }
        .header-logo { text-align: center; padding: 20px; background: linear-gradient(180deg, #112240 0%, #0a192f 100%); border-bottom: 4px solid var(--primary); }
        .main-logo { max-width: 250px; filter: drop-shadow(0 0 12px rgba(27, 74, 156, 0.6)); }
        .container { padding: 15px; max-width: 850px; margin: auto; }
        .card { background: var(--card); padding: 18px; border-radius: 15px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.05); }
        h3 { margin-top: 0; color: var(--accent); font-size: 1rem; display: flex; align-items: center; gap: 8px; text-transform: uppercase; border-bottom: 1px solid #1e3a5a; padding-bottom: 8px; }
        input, select { background: #0d1f33; border: 1px solid #1e3a5a; color: white; padding: 12px; border-radius: 8px; width: 100%; box-sizing: border-box; margin: 5px 0; outline: none; font-size: 16px; }
        button { padding: 14px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; width: 100%; margin: 5px 0; display: flex; align-items: center; justify-content: center; gap: 8px; transition: 0.3s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: var(--dark); }
        .btn-danger { background: var(--danger); color: white; }
        .btn-wpp { background: #25d366; color: white; }
        .grid-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 15px; }
        .stat-box { background: #112240; padding: 12px; border-radius: 12px; text-align: center; border: 1px solid var(--primary); }
        .stat-box b { display: block; font-size: 1rem; color: var(--success); margin-top: 4px; }
        .ai-box { background: #000; padding: 10px; border-radius: 10px; height: 120px; overflow-y: auto; font-family: monospace; font-size: 12px; color: #00ff9d; border: 1px solid var(--primary); text-align: left; }
        .hist-item { font-size: 12px; padding: 10px; border-bottom: 1px solid #1e3a5a; background: rgba(0,0,0,0.2); margin-top: 5px; border-radius: 5px; text-align: left; }
        #dashboard { display: none; }
    </style>
</head>
<body>

<div class="header-logo">
    <img src="B1BCC237-7C89-4142-8131-6DA05C2A2C61 2.png" alt="Oficina Wesley Lisboa" class="main-logo">
</div>

<div class="container">
    <div id="loginBox" class="card">
        <h3><i class="fas fa-lock"></i> Acesso Restrito</h3>
        <input id="user" placeholder="Usu√°rio">
        <input id="pass" type="password" placeholder="Senha">
        <button class="btn-primary" onclick="login()">ENTRAR</button>
    </div>

    <div id="dashboard">
        <div class="grid-stats">
            <div class="stat-box"><small>Entradas</small><b id="entrada">R$ 0</b></div>
            <div class="stat-box"><small>Sa√≠das</small><b id="saida" style="color:var(--danger)">R$ 0</b></div>
            <div class="stat-box"><small>Lucro</small><b id="lucro" style="color:var(--accent)">R$ 0</b></div>
        </div>

        <div class="card">
            <h3><i class="fas fa-search"></i> Pesquisar Placa/Cliente</h3>
            <input id="busca" placeholder="Digite para buscar..." onkeyup="buscar()">
            <div id="resultadoBusca"></div>
        </div>

        <div class="card">
            <h3><i class="fas fa-cash-register"></i> Caixa R√°pido (Lan√ßar Gasto/Ganho)</h3>
            <div style="display: flex; gap: 8px;">
                <input id="vRapido" type="number" placeholder="Valor R$">
                <button class="btn-success" onclick="addRapido('entrada')" style="width: 60px;"><i class="fas fa-plus"></i></button>
                <button class="btn-danger" onclick="addRapido('saida')" style="width: 60px;"><i class="fas fa-minus"></i></button>
            </div>
        </div>

        <div class="card">
            <h3><i class="fas fa-tools"></i> Novo Servi√ßo / Or√ßamento</h3>
            <select id="tipoVeiculo">
                <option value="Moto">üèçÔ∏è Moto</option>
                <option value="Bike">üö≤ Bike</option>
            </select>
            <input id="cliNome" placeholder="Nome do Cliente">
            <input id="cliPlaca" placeholder="Placa ou Modelo">
            <input id="cliCel" placeholder="WhatsApp (55...)">
            <input id="cliServ" placeholder="Descri√ß√£o do Servi√ßo">
            <input id="cliValor" type="number" placeholder="Pre√ßo Total R$">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                <button class="btn-success" onclick="salvarServico()"><i class="fas fa-save"></i> Salvar</button>
                <button class="btn-wpp" onclick="enviarWpp()"><i class="fab fa-whatsapp"></i> WhatsApp</button>
            </div>
            <button class="btn-primary" onclick="gerarPDF()" style="margin-top: 8px;"><i class="fas fa-file-pdf"></i> Gerar Recibo PDF</button>
        </div>

        <div class="card">
            <h3><i class="fas fa-boxes"></i> Controle de Estoque</h3>
            <div style="display: flex; gap: 5px;">
                <input id="nPeca" placeholder="Pe√ßa">
                <input id="qPeca" type="number" placeholder="Qtd" style="width:80px">
                <button class="btn-success" onclick="addEstoque()" style="width:50px"><i class="fas fa-check"></i></button>
            </div>
            <div id="listaEstoque"></div>
        </div>

        <div class="card">
            <h3><i class="fas fa-chart-line"></i> Desempenho</h3>
            <canvas id="grafico" height="150"></canvas>
        </div>

        <div class="card">
            <h3><i class="fas fa-robot"></i> Assistente Lisboa IA</h3>
            <div class="ai-box" id="chat">> Sistema Online...</div>
            <div style="display: flex; gap: 5px; margin-top:8px;">
                <input id="msgIA" placeholder="Pergunte ao sistema...">
                <button class="btn-primary" onclick="responderIA()" style="width:60px">‚û§</button>
            </div>
        </div>

        <div class="card" style="border: 1px dashed var(--danger);">
            <h3><i class="fas fa-edit"></i> Ajuste Manual de Saldo</h3>
            <input id="adjEntrada" type="number" placeholder="Novo Total Entradas">
            <input id="adjSaida" type="number" placeholder="Novo Total Sa√≠das">
            <button class="btn-danger" onclick="ajusteManual()">CORRIGIR TOTAIS</button>
        </div>

        <button class="btn-danger" onclick="location.reload()" style="margin-top: 20px;"><i class="fas fa-power-off"></i> ENCERRAR SESS√ÉO</button>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('oficina_pro_vFinal')) || { entrada: 0, saida: 0, estoque: [], historico: [] };

    function salvar() { localStorage.setItem('oficina_pro_vFinal', JSON.stringify(db)); atualizarTela(); }

    function login() {
        if (user.value === "dono" && pass.value === "1234") {
            document.getElementById('loginBox').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            atualizarTela();
        } else { alert("Senha Incorreta!"); }
    }

    function addRapido(tipo) {
        let val = parseFloat(vRapido.value);
        if(val > 0) {
            db[tipo] += val;
            db.historico.unshift({ data: new Date().toLocaleDateString(), ident: "AVULSO", serv: tipo.toUpperCase(), valor: val, nome: "Caixa R√°pido" });
            vRapido.value = ""; salvar();
        }
    }

    function salvarServico() {
        let val = parseFloat(cliValor.value);
        if(val > 0 && cliNome.value) {
            db.entrada += val;
            db.historico.unshift({
                data: new Date().toLocaleDateString(),
                nome: cliNome.value,
                ident: cliPlaca.value.toUpperCase(),
                serv: cliServ.value,
                valor: val
            });
            salvar();
            alert("Servi√ßo registrado!");
            cliNome.value = ""; cliPlaca.value = ""; cliServ.value = ""; cliValor.value = "";
        }
    }

    function buscar() {
        let t = busca.value.toUpperCase();
        let res = document.getElementById("resultadoBusca");
        res.innerHTML = "";
        if(t.length > 1) {
            db.historico.filter(h => h.ident.includes(t) || h.nome.toUpperCase().includes(t)).forEach(f => {
                res.innerHTML += `<div class="hist-item"><b>${f.data} - ${f.ident}</b><br>${f.nome} | ${f.serv} | R$ ${f.valor}</div>`;
            });
        }
    }

    function addEstoque() {
        if(nPeca.value && qPeca.value) {
            db.estoque.push({n: nPeca.value, q: qPeca.value});
            nPeca.value = ""; qPeca.value = ""; salvar();
        }
    }

    function ajusteManual() {
        if(adjEntrada.value) db.entrada = parseFloat(adjEntrada.value);
        if(adjSaida.value) db.saida = parseFloat(adjSaida.value);
        salvar(); alert("Saldos corrigidos!");
    }

    function responderIA() {
        let m = msgIA.value.toLowerCase();
        let r = "Ol√°! Como posso ajudar na gest√£o da oficina?";
        if(m.includes("lucro")) r = "O lucro l√≠quido atual √© de R$ " + (db.entrada - db.saida).toFixed(2);
        if(m.includes("estoque")) r = "Voc√™ tem " + db.estoque.length + " itens cadastrados no estoque.";
        chat.innerHTML += `<p style="color:#fff">Voc√™: ${msgIA.value}</p><p>> ${r}</p>`;
        msgIA.value = ""; chat.scrollTop = chat.scrollHeight;
    }

    function gerarPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.text("OFICINA WESLEY LISBOA - RECIBO", 10, 20);
        doc.text("Cliente: " + cliNome.value, 10, 40);
        doc.text("Ve√≠culo: " + cliPlaca.value, 10, 50);
        doc.text("Valor: R$ " + cliValor.value, 10, 60);
        doc.save("Recibo.pdf");
    }

    function enviarWpp() {
        let msg = `Ol√° ${cliNome.value}, sua manuten√ß√£o est√° pronta na Oficina Lisboa! Valor: R$ ${cliValor.value}`;
        window.open(`https://api.whatsapp.com/send?phone=${cliCel.value}&text=${msg}`);
    }

    let chart;
    function atualizarTela() {
        document.getElementById("entrada").innerHTML = "R$ " + db.entrada.toFixed(2);
        document.getElementById("saida").innerHTML = "R$ " + db.saida.toFixed(2);
        document.getElementById("lucro").innerHTML = "R$ " + (db.entrada - db.saida).toFixed(2);
        document.getElementById("listaEstoque").innerHTML = db.estoque.map((i, idx) => 
            `<div class="hist-item" style="display:flex; justify-content:space-between">
                <span>${i.n}</span><b>${i.q} un <i class="fas fa-trash" onclick="db.estoque.splice(${idx},1);salvar()" style="color:red; margin-left:10px"></i></b>
            </div>`).join('');
        
        const ctx = document.getElementById('grafico').getContext('2d');
        if(chart) chart.destroy();
        chart = new Chart(ctx, {
            type: 'bar',
            data: { labels: ['Entradas', 'Sa√≠das'], datasets: [{ data: [db.entrada, db.saida], backgroundColor: ['#00ff9d', '#ff4b2b'] }] },
            options: { plugins: { legend: { display: false } } }
        });
    }
</script>
</body>
</html>
