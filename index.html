<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LISBOA PRO - PERFORMANCE</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
:root {
    --bg:#0a0e17;
    --card:#161b28;
    --primary:#2a5ee8;
    --accent:#00d2ff;
    --success:#00f298;
    --danger:#ff4b5c;
    --text:#e1e8f0;
}
body{
    margin:0;
    font-family:'Inter',sans-serif;
    background:var(--bg);
    color:var(--text);
    padding-bottom:80px;
}
.header{
    background:var(--card);
    padding:20px;
    text-align:center;
    border-bottom:1px solid rgba(255,255,255,0.1);
}
.header img{max-width:130px;}
.container{padding:15px;max-width:600px;margin:auto;}
.balance-card{
    background:linear-gradient(135deg,#1e2a4a,#161b28);
    padding:25px;
    border-radius:24px;
    text-align:center;
    margin-bottom:20px;
    border:1px solid rgba(255,255,255,0.1);
    box-shadow:0 10px 30px rgba(0,0,0,0.3);
}
.balance-card h2{margin:0;font-size:0.8rem;text-transform:uppercase;letter-spacing:1px;opacity:0.7;}
.balance-val{font-size:2.5rem;font-weight:800;color:var(--success);margin:10px 0;}
.menu-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:25px;}
.menu-item{background:var(--card);padding:12px 5px;border-radius:16px;text-align:center;border:1px solid rgba(255,255,255,0.05);cursor:pointer;transition:0.2s;}
.menu-item i{font-size:1.2rem;color:var(--accent);margin-bottom:6px;display:block;}
.menu-item span{font-size:0.55rem;font-weight:700;text-transform:uppercase;}
.menu-item:active{transform:scale(0.9);background:var(--primary);}
.section{background:var(--card);padding:20px;border-radius:24px;display:none;border:1px solid rgba(255,255,255,0.05);}
.active{display:block;animation:slideIn 0.3s ease-out;}
@keyframes slideIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
input, select, textarea{background:#0f141e;border:1px solid #2d364a;color:white;padding:14px;border-radius:12px;width:100%;box-sizing:border-box;margin:8px 0;font-size:15px;}
button{background:var(--primary);color:white;padding:16px;border-radius:14px;border:none;font-weight:700;width:100%;cursor:pointer;margin-top:10px;font-size:14px;transition:0.2s;}
button:active{opacity:0.8;}
.btn-success{background:var(--success);color:#0a0e17;}
.btn-danger{background:var(--danger);}
.list-item{background:rgba(255,255,255,0.03);padding:15px;border-radius:16px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center;border-left:4px solid var(--primary);}
.badge{background:var(--danger);color:white;border-radius:50px;padding:2px 8px;font-size:10px;position:absolute;top:-5px;right:-5px;}
.ia-box{background:#000;border:1px solid var(--success);padding:15px;border-radius:12px;font-family:'Courier New',monospace;color:var(--success);font-size:13px;line-height:1.4;}
#toast{visibility:hidden;min-width:200px;margin-left:-100px;background-color:#333;color:#fff;text-align:center;border-radius:8px;padding:16px;position:fixed;z-index:999;left:50%;bottom:30px;font-size:14px;}
#toast.show{visibility:visible;animation:fadein 0.5s,fadeout 0.5s 2s;}
@keyframes fadein{from{bottom:0;opacity:0;}to{bottom:30px;opacity:1;}}
@keyframes fadeout{from{bottom:30px;opacity:1;}to{bottom:0;opacity:0;}}
</style>
</head>
<body>

<div class="header">
    <img src="B1BCC237-7C89-4142-8131-6DA05C2A2C61 2.png" alt="Lisboa Pro">
</div>

<!-- LOGIN -->
<div id="loginPage" class="container">
    <div class="balance-card">
        <i class="fas fa-shield-alt" style="font-size:2rem;color:var(--accent)"></i>
        <h3>ACESSO RESTRITO</h3>
        <input id="senha" type="password" placeholder="Senha Administrativa">
        <button id="btnLogin">ENTRAR NO PAINEL</button>
    </div>
</div>

<!-- CONTE√öDO PRINCIPAL -->
<div id="mainPage" class="container" style="display:none">
<!-- Se√ß√µes ser√£o adicionadas na pr√≥xima parte -->
</div>

<div id="toast"></div>
<!-- SALDO E DASHBOARD -->
<div class="balance-card">
    <h2>Saldo Real (LUCRO LIMPO)</h2>
    <div class="balance-val" id="val-lucro">R$ 0,00</div>
    <div style="display:flex;justify-content:space-around;opacity:0.8;font-size:12px;">
        <span>M√£o de Obra: <b id="val-mao" style="color:var(--accent)">R$ 0</b></span>
        <span>Contas: <b id="val-contas" style="color:var(--danger)">R$ 0</b></span>
    </div>
</div>

<!-- MENU PRINCIPAL -->
<div class="menu-grid">
    <div class="menu-item" onclick="nav('sec-dash')"><i class="fas fa-chart-line"></i><span>Dash</span></div>
    <div class="menu-item" onclick="nav('sec-serv')"><i class="fas fa-plus"></i><span>Novo</span></div>
    <div class="menu-item" onclick="nav('sec-contas')"><i class="fas fa-receipt"></i><span>Contas</span></div>
    <div class="menu-item" onclick="nav('sec-hist')"><i class="fas fa-search"></i><span>Busca</span></div>
    <div class="menu-item" onclick="nav('sec-oleo')" style="position:relative">
        <i class="fas fa-oil-can"></i><span>√ìleo</span>
        <span id="notif-oleo" class="badge" style="display:none">0</span>
    </div>
    <div class="menu-item" onclick="nav('sec-estoque')"><i class="fas fa-box"></i><span>Estoque</span></div>
    <div class="menu-item" onclick="nav('sec-tabela')"><i class="fas fa-tags"></i><span>Tabela</span></div>
    <div class="menu-item" onclick="nav('sec-taxa')"><i class="fas fa-credit-card"></i><span>Taxas</span></div>
    <div class="menu-item" onclick="nav('sec-agenda')"><i class="fas fa-calendar"></i><span>Agenda</span></div>
    <div class="menu-item" onclick="nav('sec-compras')"><i class="fas fa-cart-plus"></i><span>Compras</span></div>
    <div class="menu-item" onclick="nav('sec-check')"><i class="fas fa-clipboard-list"></i><span>Check</span></div>
    <div class="menu-item" onclick="nav('sec-ia')"><i class="fas fa-brain"></i><span>I.A</span></div>
</div>

<!-- SE√á√ÉO DASHBOARD -->
<div id="sec-dash" class="section active">
    <h3>üìä Resumo Financeiro</h3>
    <canvas id="chartFin" height="200"></canvas>
    <button class="btn-success" onclick="gerarPDF()"><i class="fas fa-file-pdf"></i> GERAR RELAT√ìRIO DO M√äS</button>
    <button class="btn-danger" onclick="resetMes()" style="opacity:0.4;">ZERAR DADOS DO M√äS</button>
</div>

<!-- NOVO SERVI√áO -->
<div id="sec-serv" class="section">
    <h3>üîß Novo Servi√ßo</h3>
    <input id="sNome" placeholder="Nome do Cliente">
    <input id="sPlaca" placeholder="Placa">
    <input id="sCel" placeholder="Celular (WhatsApp)">
    <input id="sMao" type="number" placeholder="M√£o de Obra (Seu Ganho)">
    <input id="sPec" type="number" placeholder="Pe√ßas (Custo Reposi√ß√£o)">
    <select id="sOleo">
        <option value="nao">Troca de √ìleo? N√£o</option>
        <option value="sim">Troca de √ìleo? Sim (Lembrar em 90 dias)</option>
    </select>
    <button class="btn-success" onclick="salvarServico()">SALVAR SERVI√áO</button>
    <button onclick="zapOrcamento()">ENVIAR OR√áAMENTO (ZAP)</button>
</div>

<!-- CONTAS E DESPESAS -->
<div id="sec-contas" class="section">
    <h3>üí∏ Contas e Despesas</h3>
    <input id="cDesc" placeholder="Ex: Luz, Aluguel, Almo√ßo">
    <input id="cVal" type="number" placeholder="Valor R$">
    <button class="btn-danger" onclick="salvarConta()">PAGAR CONTA</button>
    <div id="lista-contas"></div>
</div>

<!-- LISTA DE √ìLEO -->
<div id="sec-oleo" class="section">
    <h3>üõ¢Ô∏è Lembrete de √ìleo</h3>
    <div id="lista-oleo"></div>
</div>

<!-- HIST√ìRICO DE SERVI√áOS -->
<div id="sec-hist" class="section">
    <h3>üìÇ Hist√≥rico</h3>
    <input id="busca" placeholder="Buscar por placa..." onkeyup="render()">
    <div id="lista-hist"></div>
</div>

<!-- ESTOQUE -->
<div id="sec-estoque" class="section">
    <h3>üì¶ Estoque</h3>
    <input id="eN" placeholder="Pe√ßa">
    <input id="eQ" type="number" placeholder="Quantidade">
    <button onclick="addObj('estoque','eN','eQ')">ADD</button>
    <div id="l-estoque"></div>
</div>

<!-- TABELA DE PRE√áOS -->
<div id="sec-tabela" class="section">
    <h3>üìã Tabela de Pre√ßos</h3>
    <input id="tN" placeholder="Servi√ßo">
    <input id="tV" placeholder="Valor">
    <button onclick="addObj('tabela','tN','tV')">ADD</button>
    <div id="l-tabela"></div>
</div>

<!-- CALCULADORA DE TAXAS (Melhoria: escolha de cart√£o ou outro m√©todo) -->
<div id="sec-taxa" class="section">
    <h3>üí≥ Calculadora de Taxas</h3>
    <input id="taxV" type="number" placeholder="Valor do Servi√ßo">
    <select id="taxMetodo">
        <option value="credito">Cart√£o de Cr√©dito (+12%)</option>
        <option value="debito">Cart√£o de D√©bito (+4%)</option>
        <option value="pix">PIX (0%)</option>
        <option value="dinheiro">Dinheiro (0%)</option>
    </select>
    <button onclick="calcTaxa()">CALCULAR</button>
</div>

<!-- AGENDA -->
<div id="sec-agenda" class="section">
    <h3>üìÖ Agenda de Retorno</h3>
    <input id="aN" placeholder="Cliente">
    <input id="aD" type="date">
    <button onclick="addObj('agenda','aN','aD')">AGENDAR</button>
    <div id="l-agenda"></div>
</div>

<!-- COMPRAS -->
<div id="sec-compras" class="section">
    <h3>üõí Lista de Compras</h3>
    <input id="cpN" placeholder="Item faltando">
    <button onclick="addObj('compras','cpN')">ADD</button>
    <div id="l-compras"></div>
</div>

<!-- CHECKLIST -->
<div id="sec-check" class="section">
    <h3>üìã Check-list Entrada</h3>
    <input id="chP" placeholder="Placa">
    <textarea id="chD" placeholder="Observa√ß√µes/Avarias"></textarea>
    <button onclick="addObj('check','chP','chD')">SALVAR</button>
    <div id="l-check"></div>
</div>

<!-- IA / ANALISTA INTELIGENTE -->
<div id="sec-ia" class="section">
    <h3>ü§ñ Analista Inteligente</h3>
    <div id="ia-res" class="ia-box">Aguardando dados...</div>
    <button onclick="analisarIA()">GERAR DIAGN√ìSTICO</button>
    <hr style="opacity:0.1;margin:20px 0">
    <button onclick="gerarBackup()" style="background:#333">GERAR C√ìDIGO BACKUP</button>
    <textarea id="txtBack" style="font-size:8px"></textarea>
</div>
<script>
// Banco de dados centralizado
let db = JSON.parse(localStorage.getItem('lisboa_vfinal')) || {
    mao:0, contas:0, pecas:0,
    servicos:[], despesas:[],
    estoque:[], tabela:[], agenda:[],
    compras:[], check:[]
};

let chart;

// Fun√ß√£o de salvar no localStorage
function save() {
    localStorage.setItem('lisboa_vfinal', JSON.stringify(db));
    render();
}

// Fun√ß√£o de navega√ß√£o entre se√ß√µes
function nav(id) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}

// Toast de alerta
function showToast(msg){
    const t = document.getElementById('toast');
    t.innerText = msg;
    t.className = "show";
    setTimeout(()=>{ t.className = t.className.replace("show",""); }, 2500);
}

// SALVAR SERVI√áO
function salvarServico(){
    let m = parseFloat(document.getElementById('sMao').value)||0;
    let p = parseFloat(document.getElementById('sPec').value)||0;
    if(m+p>0){
        db.mao += m;
        db.pecas += p;
        db.servicos.unshift({
            n: document.getElementById('sNome').value,
            p: document.getElementById('sPlaca').value.toUpperCase(),
            v: m+p,
            m: m,
            pe: p,
            z: document.getElementById('sCel').value,
            ol: document.getElementById('sOleo').value,
            d: new Date().getTime()
        });
        document.getElementById('sMao').value='';
        document.getElementById('sPec').value='';
        document.getElementById('sNome').value='';
        document.getElementById('sPlaca').value='';
        document.getElementById('sCel').value='';
        save();
        showToast("‚úÖ Servi√ßo salvo!");
    } else showToast("‚ö†Ô∏è Insira valores v√°lidos!");
}

// SALVAR CONTA
function salvarConta(){
    let v = parseFloat(document.getElementById('cVal').value)||0;
    if(v>0){
        db.contas += v;
        db.despesas.unshift({
            n: document.getElementById('cDesc').value,
            v: v,
            d: new Date().toLocaleDateString()
        });
        document.getElementById('cVal').value='';
        document.getElementById('cDesc').value='';
        save();
        showToast("‚úÖ Conta salva!");
    } else showToast("‚ö†Ô∏è Valor inv√°lido!");
}

// ADICIONAR OBJETO (Estoque, Tabela, Agenda, Compras, Check)
function addObj(t,id1,id2){
    let obj = { n: document.getElementById(id1).value, v: id2 ? document.getElementById(id2).value : null };
    if(obj.n){
        db[t].push(obj);
        document.getElementById(id1).value='';
        if(id2) document.getElementById(id2).value='';
        save();
        showToast("‚úÖ Adicionado!");
    } else showToast("‚ö†Ô∏è Preencha o nome!");
}

// RENDERIZA√á√ÉO DE LISTAS E DASHBOARD
function render(){
    let lucro = db.mao - db.contas;
    document.getElementById('val-lucro').innerText = "R$ "+lucro.toFixed(2);
    document.getElementById('val-mao').innerText = "R$ "+db.mao.toFixed(2);
    document.getElementById('val-contas').innerText = "R$ "+db.contas.toFixed(2);

    // Hist√≥rico
    let busca = document.getElementById('busca') ? document.getElementById('busca').value.toUpperCase() : '';
    document.getElementById('lista-hist').innerHTML = db.servicos
        .filter(s=>s.p.includes(busca))
        .map(s=>`<div class="list-item"><span><b>${s.p}</b> - ${s.n}</span><b>R$ ${s.v}</b></div>`).join('');
    
    // Contas
    document.getElementById('lista-contas').innerHTML = db.despesas
        .map(d=>`<div class="list-item"><span>${d.n}</span><b style="color:red">- R$ ${d.v}</b></div>`).join('');

    // √ìleo
    let hoje = new Date().getTime();
    let vencidos=0;
    let htmlOleo="";
    db.servicos.forEach(s=>{
        if(s.ol==='sim'){
            let dias = Math.floor((hoje - s.d)/(1000*60*60*24));
            if(dias>=90){
                vencidos++;
                htmlOleo+=`<div class="list-item" style="border-left-color:red"><span>${s.p} - ${s.n} (${dias} dias)</span><i class="fab fa-whatsapp" onclick="window.open('https://api.whatsapp.com/send?phone=${s.z}&text=Ol√°! J√° faz 3 meses da √∫ltima troca de √≥leo. Vamos agendar?')"></i></div>`;
            }
        }
    });
    document.getElementById('notif-oleo').innerText=vencidos;
    document.getElementById('notif-oleo').style.display=vencidos>0?'block':'none';
    document.getElementById('lista-oleo').innerHTML = htmlOleo || "Sem trocas pendentes.";

    // Gr√°fico
    const ctx=document.getElementById('chartFin').getContext('2d');
    if(chart) chart.destroy();
    chart=new Chart(ctx,{
        type:'doughnut',
        data:{
            labels:['Lucro Limpo','Contas Fixas','Custo Pe√ßas'],
            datasets:[{data:[lucro>0?lucro:0,db.contas,db.pecas],backgroundColor:['#00f298','#ff4b5c','#00d2ff'],borderWidth:0}]
        },
        options:{plugins:{legend:{labels:{color:'white'}}}}
    });
}

// IA / ANALISTA INTELIGENTE
function analisarIA(){
    let lucro = db.mao - db.contas;
    let analise="";
    if(lucro<=0) analise="> ALERTA CR√çTICO: Voc√™ est√° pagando para trabalhar. Suas contas superaram o ganho de m√£o de obra.";
    else if(db.contas>db.mao*0.5) analise="> CUIDADO: Despesas fixas consumindo mais de 50% do lucro.";
    else analise="> SA√öDE √ìTIMA: Lucro saud√°vel: R$ "+lucro.toFixed(2);
    document.getElementById('ia-res').innerText = analise + "\n\n> DICA: " + (db.servicos.length<5?"Cadastre mais servi√ßos para an√°lise precisa":"Use a lista de √≥leo para atrair clientes antigos.");
}

// OR√áAMENTO WHATSAPP
function zapOrcamento(){
    if(document.getElementById('sCel').value){
        let msg=`Ol√°! Or√ßamento Lisboa: M√£o de Obra R$ ${document.getElementById('sMao').value}, Pe√ßas R$ ${document.getElementById('sPec').value}. Total R$ ${parseFloat(document.getElementById('sMao').value)+parseFloat(document.getElementById('sPec').value)}`;
        window.open(`https://api.whatsapp.com/send?phone=${document.getElementById('sCel').value}&text=${encodeURIComponent(msg)}`);
    } else showToast("‚ö†Ô∏è Insira o n√∫mero do cliente!");
}

// GERAR PDF
function gerarPDF(){
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.text("Relat√≥rio Lisboa Pro",10,10);
    doc.text(`Lucro: R$ ${db.mao - db.contas}`,10,20);
    doc.save("mes.pdf");
}

// CALCULAR TAXA
function calcTaxa(){
    let valor = parseFloat(document.getElementById('taxV').value)||0;
    let metodo = document.getElementById('taxMetodo').value;
    let total = valor;
    if(metodo==='credito') total = valor*1.12;
    else if(metodo==='debito') total = valor*1.04;
    alert(`Para receber R$ ${valor.toFixed(2)}, cobre do cliente: R$ ${total.toFixed(2)} (${metodo})`);
}

// RESETAR M√äS
function resetMes(){
    if(confirm("Deseja zerar ganhos? O hist√≥rico n√£o ser√° apagado.")){
        db.mao=0; db.contas=0; db.pecas=0; save();
        showToast("‚úÖ Dados do m√™s zerados!");
    }
}

// GERAR BACKUP
function gerarBackup(){
    document.getElementById('txtBack').value = btoa(JSON.stringify(db));
    showToast("‚úÖ Backup gerado!");
}

// Render inicial
render();
</script>
</body>
</html>
