<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LISBOA PRO ELITE V4</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --bg: #f0f2f5; --card: #ffffff; --primary: #1a73e8; --secondary: #5f6368; --success: #1e8e3e; --danger: #d93025; --text: #202124; --input-bg: #f8f9fa; }
        
        body { margin: 0; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text); padding-bottom: 100px; }
        
        /* Header Profissional */
        .header { background: #1a237e; color: white; padding: 20px; text-align: center; border-bottom-left-radius: 20px; border-bottom-right-radius: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .header img { max-width: 120px; filter: brightness(0) invert(1); }

        .container { padding: 15px; max-width: 500px; margin: auto; }

        /* Card de Saldo Estilo Banco */
        .balance-card { 
            background: linear-gradient(135deg, #1a237e 0%, #3949ab 100%); 
            padding: 25px; border-radius: 24px; color: white; margin-bottom: 20px;
            box-shadow: 0 10px 20px rgba(26, 35, 126, 0.2);
        }
        .balance-val { font-size: 2.4rem; font-weight: 800; margin: 5px 0; }

        /* Grid de Menu (12 Op√ß√µes) */
        .menu-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
        .menu-item { background: var(--card); padding: 12px 5px; border-radius: 15px; text-align: center; box-shadow: 0 2px 6px rgba(0,0,0,0.05); cursor: pointer; border: 1px solid #eee; }
        .menu-item i { font-size: 1.2rem; color: var(--primary); margin-bottom: 4px; display: block; }
        .menu-item span { font-size: 0.55rem; font-weight: 700; text-transform: uppercase; color: var(--secondary); }

        /* Se√ß√µes */
        .section { display: none; background: var(--card); padding: 20px; border-radius: 20px; box-shadow: 0 2px 12px rgba(0,0,0,0.05); animation: fadeIn 0.3s ease; }
        .active { display: block !important; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* INPUTS MELHORADOS (FIM DO PRETO NO PRETO) */
        label { font-size: 0.8rem; font-weight: 700; color: var(--primary); margin-left: 5px; }
        input, select, textarea { 
            background: var(--input-bg); border: 2px solid #e8eaed; 
            color: #202124; padding: 14px; border-radius: 12px; width: 100%; box-sizing: border-box; 
            margin: 8px 0 15px 0; font-size: 16px; transition: 0.3s;
        }
        input:focus { border-color: var(--primary); background: #fff; outline: none; box-shadow: 0 0 8px rgba(26,115,232,0.2); }

        button { 
            background: var(--primary); color: white; padding: 16px; border-radius: 12px; 
            border: none; font-weight: 700; width: 100%; font-size: 15px; cursor: pointer;
        }
        .btn-despesa { background: var(--danger); }
        .btn-whats { background: #25d366; margin-top: 5px; }

        /* Listas */
        .list-item { background: #f8f9fa; padding: 15px; border-radius: 12px; margin-bottom: 8px; border-left: 4px solid var(--primary); display: flex; justify-content: space-between; align-items: center; }

        /* NavBar Inferior */
        .nav-bar { 
            position: fixed; bottom: 0; left: 0; right: 0; background: white;
            display: flex; justify-content: space-around; padding: 12px 10px 25px 10px;
            box-shadow: 0 -4px 10px rgba(0,0,0,0.05); border-top: 1px solid #eee;
        }
        .nav-item { color: #bdc1c6; font-size: 1.4rem; }
        .nav-item.active { color: var(--primary); }
    </style>
</head>
<body>

<div id="loginPage" class="container" style="margin-top:50px; text-align:center;">
    <img src="B1BCC237-7C89-4142-8131-6DA05C2A2C61 2.png" style="max-width: 140px; margin-bottom: 20px;">
    <div style="background: white; padding: 30px; border-radius: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
        <h3 style="margin:0 0 20px 0;">Acesso Lisboa Pro</h3>
        <input id="pass" type="password" placeholder="Digite a senha" style="text-align:center">
        <button onclick="login()">ENTRAR</button>
    </div>
</div>

<div id="mainApp" style="display:none">
    <div class="header">
        <img src="B1BCC237-7C89-4142-8131-6DA05C2A2C61 2.png">
    </div>

    <div class="container">
        <div id="sec-dash" class="section active">
            <div class="balance-card">
                <span style="opacity:0.8; font-size:0.8rem; font-weight:bold;">LUCRO L√çQUIDO</span>
                <div class="balance-val" id="res-lucro">R$ 0,00</div>
                <div style="display:flex; justify-content:space-between; border-top:1px solid rgba(255,255,255,0.2); padding-top:10px;">
                    <span>Ganhos: <b id="res-mao">R$ 0</b></span>
                    <span>Gastos: <b id="res-contas">R$ 0</b></span>
                </div>
            </div>

            <div class="menu-grid">
                <div class="menu-item" onclick="nav('sec-oleo')"><i class="fas fa-oil-can"></i><span>√ìleo</span></div>
                <div class="menu-item" onclick="nav('sec-estoque')"><i class="fas fa-box"></i><span>Estoque</span></div>
                <div class="menu-item" onclick="nav('sec-tabela')"><i class="fas fa-tags"></i><span>Tabela</span></div>
                <div class="menu-item" onclick="nav('sec-ia')"><i class="fas fa-brain"></i><span>I.A</span></div>
                <div class="menu-item" onclick="nav('sec-agenda')"><i class="fas fa-calendar"></i><span>Agenda</span></div>
                <div class="menu-item" onclick="nav('sec-compras')"><i class="fas fa-shopping-cart"></i><span>Compras</span></div>
                <div class="menu-item" onclick="nav('sec-check')"><i class="fas fa-clipboard-check"></i><span>Check</span></div>
                <div class="menu-item" onclick="nav('sec-taxa')"><i class="fas fa-percentage"></i><span>Taxas</span></div>
            </div>
            <canvas id="chartFin" height="150"></canvas>
        </div>

        <div id="sec-serv" class="section">
            <h3>üî® Novo Servi√ßo</h3>
            <label>Nome do Cliente</label><input id="sNome" placeholder="Ex: Jo√£o da Silva">
            <label>Placa da Moto</label><input id="sPlaca" placeholder="ABC-1234" style="text-transform:uppercase">
            <label>WhatsApp</label><input id="sCel" type="tel" placeholder="55119...">
            <label>Sua M√£o de Obra (R$)</label><input id="sMao" type="number" placeholder="Quanto voc√™ ganhou">
            <label>Custo das Pe√ßas (R$)</label><input id="sPec" type="number" placeholder="Quanto custou as pe√ßas">
            <label>Teve troca de √ìleo?</label><select id="sOleo"><option value="nao">N√£o</option><option value="sim">Sim (Lembrar em 90 dias)</option></select>
            <button onclick="salvarServico()">SALVAR SERVI√áO</button>
        </div>

        <div id="sec-contas" class="section">
            <h3>üí∏ Registrar Gasto</h3>
            <label>Descri√ß√£o</label><input id="cDesc" placeholder="Ex: Aluguel, Luz, Pe√ßas">
            <label>Valor Pago (R$)</label><input id="cVal" type="number" placeholder="0.00">
            <button class="btn-despesa" onclick="salvarConta()">PAGAR E DESCONTAR</button>
            <div id="lista-contas" style="margin-top:20px"></div>
        </div>

        <div id="sec-busca" class="section">
            <h3>üìÇ Hist√≥rico</h3>
            <input id="query" placeholder="üîç Buscar pela placa..." onkeyup="render()">
            <div id="lista-hist"></div>
        </div>

        <div id="sec-oleo" class="section"><h3>üõ¢Ô∏è Retorno de √ìleo</h3><div id="lista-oleo"></div></div>
        <div id="sec-estoque" class="section"><h3>üì¶ Estoque</h3><input id="eN" placeholder="Pe√ßa"><input id="eQ" type="number"><button onclick="addObj('estoque','eN','eQ')">ADD</button><div id="l-estoque"></div></div>
        <div id="sec-tabela" class="section"><h3>üìã Tabela</h3><input id="tN" placeholder="Servi√ßo"><input id="tV" placeholder="Valor"><button onclick="addObj('tabela','tN','tV')">ADD</button><div id="l-tabela"></div></div>
        <div id="sec-agenda" class="section"><h3>üìÖ Agenda</h3><input id="aN"><input id="aD" type="date"><button onclick="addObj('agenda','aN','aD')">ADD</button><div id="l-agenda"></div></div>
        <div id="sec-compras" class="section"><h3>üõí Compras</h3><input id="cpN"><button onclick="addObj('compras','cpN')">ADD</button><div id="l-compras"></div></div>
        <div id="sec-check" class="section"><h3>üìã Check-list</h3><input id="chP" placeholder="Placa"><textarea id="chD"></textarea><button onclick="addObj('check','chP','chD')">ADD</button><div id="l-check"></div></div>
        <div id="sec-taxa" class="section"><h3>üí≥ Taxas Cart√£o</h3><input id="txV" type="number"><button onclick="alert('Cobre: '+(txV.value*1.12).toFixed(2))">CALCULAR (+12%)</button></div>
        <div id="sec-ia" class="section"><h3>ü§ñ Gest√£o I.A</h3><div id="ia-res" class="list-item">Pressione Analisar...</div><button onclick="analisarIA()">ANALISAR FINANCEIRO</button><br><button onclick="alert(btoa(JSON.stringify(db)))">GERAR BACKUP</button></div>

    </div>

    <div class="nav-bar">
        <div class="nav-item active" id="n-dash" onclick="nav('sec-dash')"><i class="fas fa-home"></i></div>
        <div class="nav-item" id="n-serv" onclick="nav('sec-serv')"><i class="fas fa-plus-circle"></i></div>
        <div class="nav-item" id="n-busca" onclick="nav('sec-busca')"><i class="fas fa-search"></i></div>
        <div class="nav-item" id="n-contas" onclick="nav('sec-contas')"><i class="fas fa-wallet"></i></div>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('lisboa_v4_final')) || { mao:0, contas:0, pecas:0, servicos:[], despesas:[], estoque:[], tabela:[], agenda:[], compras:[], check:[] };
    let chart;

    function save() { localStorage.setItem('lisboa_v4_final', JSON.stringify(db)); render(); }
    function login() { if(pass.value === '1234') { loginPage.style.display='none'; mainApp.style.display='block'; render(); } }
    
    function nav(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(id==='sec-dash') n-dash.classList.add('active');
        if(id==='sec-serv') n-serv.classList.add('active');
        if(id==='sec-busca') n-busca.classList.add('active');
        if(id==='sec-contas') n-contas.classList.add('active');
        window.scrollTo(0,0);
    }

    function salvarServico() {
        let m = parseFloat(sMao.value) || 0; let p = parseFloat(sPec.value) || 0;
        if(!m || !sNome.value) return alert("Preencha Nome e M√£o de Obra!");
        db.mao += m; db.pecas += p;
        db.servicos.unshift({ n: sNome.value, p: sPlaca.value.toUpperCase(), v: m+p, m, p, ol: sOleo.value, z: sCel.value, d: new Date().getTime() });
        sMao.value=''; sPec.value=''; sNome.value=''; sPlaca.value=''; save(); nav('sec-dash');
    }

    function salvarConta() {
        let v = parseFloat(cVal.value) || 0; if(!v) return;
        db.contas += v; db.despesas.unshift({ n: cDesc.value, v: v, d: new Date().toLocaleDateString() });
        cVal.value=''; cDesc.value=''; save();
    }

    function addObj(t, i1, i2) {
        db[t].push({ n: document.getElementById(i1).value, v: i2 ? document.getElementById(i2).value : null });
        save(); alert("Adicionado!");
    }

    function render() {
        let lucro = db.mao - db.contas;
        document.getElementById('res-lucro').innerText = "R$ " + lucro.toLocaleString('pt-BR',{minimumFractionDigits:2});
        document.getElementById('res-mao').innerText = "R$ " + db.mao.toFixed(2);
        document.getElementById('res-contas').innerText = "R$ " + db.contas.toFixed(2);

        document.getElementById('lista-hist').innerHTML = db.servicos.filter(s => s.p.includes(query.value.toUpperCase())).map(s => `<div class="list-item"><div><b>${s.p}</b><br><small>${s.n}</small></div><b>R$ ${s.v}</b></div>`).join('');
        document.getElementById('lista-contas').innerHTML = db.despesas.map(d => `<div class="list-item"><span>${d.n}</span><b style="color:red">- R$ ${d.v}</b></div>`).join('');
        
        let hoje = new Date().getTime();
        document.getElementById('lista-oleo').innerHTML = db.servicos.filter(s => s.ol==='sim' && (hoje-s.d)>(90*24*60*60*1000)).map(s => `<div class="list-item"><span>${s.p}</span><button class="btn-whats" onclick="window.open('https://api.whatsapp.com/send?phone=${s.z}&text=Ol√°! Troca de √≥leo pendente!')">ZAP</button></div>`).join('');

        const ctx = document.getElementById('chartFin').getContext('2d');
        if(chart) chart.destroy();
        chart = new Chart(ctx, { type: 'line', data: { labels: ['','','','',''], datasets: [{ label:'Lucro', data:[0, lucro*0.5, lucro], borderColor:'#1a73e8', fill:true, backgroundColor:'rgba(26,115,232,0.1)' }] }, options: { plugins: { legend: { display:false } }, scales: { y:{display:false}, x:{display:false} } } });
    }

    function analisarIA() {
        let l = db.mao - db.contas;
        document.getElementById('ia-res').innerText = l > 0 ? "Financeiro saud√°vel! Voc√™ tem R$ "+l.toFixed(2)+" de lucro limpo." : "Aten√ß√£o! As contas est√£o maiores que os ganhos.";
    }
</script>
</body>
</html>
