<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lisboa Pro - Oficina</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>

<style>
:root{
  --bg:#0a0e17; --card:#161b28; --primary:#2a5ee8;
  --accent:#00d2ff; --success:#00f298; --danger:#ff4b5c; --text:#e1e8f0;
}
body{margin:0;font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);padding:20px;}
.header{text-align:center;padding:15px;background:var(--card);border-radius:12px;margin-bottom:20px;}
.header img{max-width:120px;}
.card{background:var(--card);border-radius:15px;padding:15px;margin-bottom:15px;}
input, select, textarea{width:100%;padding:12px;margin:8px 0;border-radius:10px;border:1px solid #2d364a;background:#0f141e;color:white;}
button{width:100%;padding:12px;border:none;border-radius:12px;background:var(--primary);color:white;font-weight:bold;margin-top:8px;cursor:pointer;transition:0.2s;}
button:active{opacity:0.8;}
.menu-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:20px;}
.menu-item{text-align:center;padding:10px;border-radius:12px;background:var(--card);cursor:pointer;transition:0.2s;position:relative;}
.menu-item i{font-size:1.2rem;color:var(--accent);margin-bottom:6px;display:block;}
.menu-item span{font-size:0.6rem;font-weight:bold;}
.menu-item:hover{background:var(--primary);}
.section{display:none;}
.active{display:block;}
.balance-val{font-size:2rem;color:var(--success);margin:5px 0;}
.list-item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-left:4px solid var(--primary);margin-bottom:5px;border-radius:8px;background:rgba(255,255,255,0.05);}
.ia-box{background:#000;border:1px solid var(--success);padding:12px;border-radius:10px;font-family:'Courier New',monospace;color:var(--success);}
.badge{background:var(--danger);border-radius:50px;padding:2px 6px;font-size:10px;position:absolute;top:-5px;right:-5px;}
.toast{position:fixed;bottom:20px;right:20px;background:var(--accent);color:#000;padding:12px 20px;border-radius:12px;box-shadow:0 5px 15px rgba(0,0,0,0.3);opacity:0;pointer-events:none;transition:0.5s;}
.toast.show{opacity:1;pointer-events:auto;}
</style>
</head>
<body>

<div class="header">
  <img src="B1BCC237-7C89-4142-8131-6DA05C2A2C61 2.png" alt="Lisboa Pro">
</div>

<div id="loginPage" class="card">
  <h2>ğŸ”’ Login Administrador</h2>
  <input id="senha" type="password" placeholder="Digite a senha">
  <button id="btnLogin">ENTRAR</button>
</div>

<div id="mainPage" style="display:none;">
  <!-- Dashboard Financeiro -->
  <div class="card">
    <h3>Saldo (Lucro LÃ­quido)</h3>
    <div class="balance-val" id="val-lucro">R$ 0</div>
    <div style="display:flex;justify-content:space-between;font-size:12px;">
      <span>MÃ£o de Obra: <b id="val-mao" style="color:var(--accent)">0</b></span>
      <span>Contas: <b id="val-contas" style="color:var(--danger)">0</b></span>
    </div>
  </div>

  <!-- Menu -->
  <div class="menu-grid">
    <div class="menu-item" onclick="nav('sec-dash')"><i class="fas fa-chart-line"></i><span>Dash</span></div>
    <div class="menu-item" onclick="nav('sec-serv')"><i class="fas fa-plus"></i><span>Novo</span></div>
    <div class="menu-item" onclick="nav('sec-contas')"><i class="fas fa-receipt"></i><span>Contas</span></div>
    <div class="menu-item" onclick="nav('sec-hist')"><i class="fas fa-search"></i><span>Busca</span></div>
    <div class="menu-item" onclick="nav('sec-oleo')" style="position:relative">
      <i class="fas fa-oil-can"></i><span>Ã“leo</span>
      <span id="notif-oleo" class="badge" style="display:none">0</span>
    </div>
    <div class="menu-item" onclick="nav('sec-estoque')"><i class="fas fa-box"></i><span>Estoque</span></div>
    <div class="menu-item" onclick="nav('sec-tabela')"><i class="fas fa-tags"></i><span>Tabela</span></div>
    <div class="menu-item" onclick="nav('sec-taxa')"><i class="fas fa-credit-card"></i><span>Taxas</span></div>
    <div class="menu-item" onclick="nav('sec-agenda')"><i class="fas fa-calendar"></i><span>Agenda</span></div>
    <div class="menu-item" onclick="nav('sec-compras')"><i class="fas fa-cart-plus"></i><span>Compras</span></div>
    <div class="menu-item" onclick="nav('sec-check')"><i class="fas fa-clipboard-list"></i><span>Check</span></div>
    <div class="menu-item" onclick="nav('sec-ia')"><i class="fas fa-brain"></i><span>I.A</span></div>
  </div>

  <!-- SeÃ§Ãµes -->
  <div id="sec-dash" class="section active card">
    <h3>ğŸ“Š Dashboard</h3>
    <canvas id="chartFin" height="200"></canvas>
    <button onclick="gerarPDF()">ğŸ“„ Gerar RelatÃ³rio PDF</button>
    <button onclick="resetMes()" style="background:red;">ğŸ”„ Resetar Ganhos do MÃªs</button>
  </div>

  <div id="sec-serv" class="section card">
    <h3>ğŸ”§ Novo ServiÃ§o</h3>
    <input id="sNome" placeholder="Nome Cliente">
    <input id="sPlaca" placeholder="Placa">
    <input id="sCel" placeholder="Celular WhatsApp">
    <input id="sMao" type="number" placeholder="MÃ£o de Obra">
    <input id="sPec" type="number" placeholder="PeÃ§as">
    <select id="sOleo">
      <option value="nao">Troca de Ã“leo? NÃ£o</option>
      <option value="sim">Sim - Avisar em 90 dias</option>
    </select>
    <button onclick="salvarServico()">ğŸ’¾ Salvar ServiÃ§o</button>
    <button onclick="zapOrcamento()">ğŸ“± Enviar OrÃ§amento WhatsApp</button>
  </div>

  <div id="sec-contas" class="section card">
    <h3>ğŸ’¸ Contas</h3>
    <input id="cDesc" placeholder="DescriÃ§Ã£o">
    <input id="cVal" type="number" placeholder="Valor R$">
    <button onclick="salvarConta()">ğŸ’° Pagar Conta</button>
    <div id="lista-contas"></div>
  </div>

  <div id="sec-hist" class="section card">
    <h3>ğŸ“‚ HistÃ³rico</h3>
    <input id="busca" placeholder="Buscar por placa..." onkeyup="render()">
    <div id="lista-hist"></div>
  </div>

  <div id="sec-oleo" class="section card">
    <h3>ğŸ›¢ï¸ Ã“leo - Lembretes</h3>
    <div id="lista-oleo">Nenhum alerta</div>
  </div>
  <div id="sec-estoque" class="section card">
    <h3>ğŸ“¦ Estoque</h3>
    <input id="eN" placeholder="Nome do item">
    <input id="eQ" type="number" placeholder="Quantidade">
    <button onclick="addObj('estoque','eN','eQ')">â• Adicionar</button>
    <div id="l-estoque"></div>
  </div>

  <div id="sec-tabela" class="section card">
    <h3>ğŸ“‹ Tabela de PreÃ§os</h3>
    <input id="tN" placeholder="ServiÃ§o">
    <input id="tV" placeholder="Valor R$">
    <button onclick="addObj('tabela','tN','tV')">â• Adicionar</button>
    <div id="l-tabela"></div>
  </div>

  <div id="sec-taxa" class="section card">
    <h3>ğŸ’³ Calculadora de Taxas</h3>
    <input id="taxV" type="number" placeholder="Valor ServiÃ§o">
    <button onclick="calcTaxa()">Calcular (+12%)</button>
  </div>

  <div id="sec-agenda" class="section card">
    <h3>ğŸ“… Agenda de Retorno</h3>
    <input id="aN" placeholder="Cliente">
    <input id="aD" type="date">
    <button onclick="addObj('agenda','aN','aD')">Agendar</button>
    <div id="l-agenda"></div>
  </div>

  <div id="sec-compras" class="section card">
    <h3>ğŸ›’ Lista de Compras</h3>
    <input id="cpN" placeholder="Item faltando">
    <button onclick="addObj('compras','cpN')">â• Adicionar</button>
    <div id="l-compras"></div>
  </div>

  <div id="sec-check" class="section card">
    <h3>ğŸ“‹ Check-list Entrada</h3>
    <input id="chP" placeholder="Placa">
    <textarea id="chD" placeholder="ObservaÃ§Ãµes/Avarias"></textarea>
    <button onclick="addObj('check','chP','chD')">ğŸ’¾ Salvar</button>
    <div id="l-check"></div>
  </div>

  <div id="sec-ia" class="section card">
    <h3>ğŸ¤– Analista Inteligente</h3>
    <div id="ia-res" class="ia-box">Aguardando dados...</div>
    <button onclick="analisarIA()">Gerar DiagnÃ³stico</button>
    <hr style="opacity:0.1;margin:15px 0;">
    <button onclick="gerarBackup()" style="background:#333;">Gerar CÃ³digo Backup</button>
    <textarea id="txtBack" style="width:100%;height:80px;font-size:10px;"></textarea>
  </div>

</div> <!-- Fecha mainPage -->

<script>
  // Dados salvos localmente
  let db = JSON.parse(localStorage.getItem('lisboa_vfinal')) || {
    mao:0, contas:0, pecas:0,
    servicos:[], despesas:[], estoque:[], tabela:[], agenda:[], compras:[], check:[]
  };
  let chart;

  // FunÃ§Ãµes de navegaÃ§Ã£o e salvar
  const loginPage = document.getElementById('loginPage');
  const mainPage = document.getElementById('mainPage');
  document.getElementById('btnLogin').onclick = () => {
    if(document.getElementById('senha').value === '1234'){
      loginPage.style.display='none';
      mainPage.style.display='block';
      render();
    } else alert("Senha incorreta!");
  }

  function save(){ localStorage.setItem('lisboa_vfinal', JSON.stringify(db)); render(); }
  function nav(id){ document.querySelectorAll('.section').forEach(s=>s.classList.remove('active')); document.getElementById(id).classList.add('active'); }

  function salvarServico(){
    let m=parseFloat(sMao.value)||0;
    let p=parseFloat(sPec.value)||0;
    if(m+p>0){
      db.mao+=m; db.pecas+=p;
      db.servicos.unshift({
        n: sNome.value, p: sPlaca.value.toUpperCase(), v: (m+p),
        m: m, pe: p, z: sCel.value, ol: sOleo.value, d: new Date().getTime()
      });
      sMao.value=''; sPec.value=''; sNome.value=''; save();
      alert("âœ… ServiÃ§o salvo!");
    }
  }

  function salvarConta(){
    let v=parseFloat(cVal.value)||0;
    if(v>0){ db.contas+=v; db.despesas.unshift({n:cDesc.value,v:v,d:new Date().toLocaleDateString()}); cVal.value=''; cDesc.value=''; save(); }
  }

  function addObj(t,id1,id2){
    let obj={n:document.getElementById(id1).value};
    if(id2) obj.v=document.getElementById(id2).value;
    db[t].push(obj); save();
  }

  function render(){
    let lucro=db.mao-db.contas;
    document.getElementById('val-lucro').innerText="R$ "+lucro.toFixed(2);
    document.getElementById('val-mao').innerText="R$ "+db.mao.toFixed(2);
    document.getElementById('val-contas').innerText="R$ "+db.contas.toFixed(2);

    // HistÃ³rico
    document.getElementById('lista-hist').innerHTML=db.servicos.filter(s=>s.p.includes(busca.value.toUpperCase())).map(s=>`<div class="list-item"><span><b>${s.p}</b> - ${s.n}</span><b>R$ ${s.v}</b></div>`).join('');
    document.getElementById('lista-contas').innerHTML=db.despesas.map(d=>`<div class="list-item"><span>${d.n}</span><b style="color:red">- R$ ${d.v}</b></div>`).join('');

    // Ã“leo
    let hoje=new Date().getTime(); let vencidos=0; let htmlOleo="";
    db.servicos.forEach(s=>{
      if(s.ol==='sim'){
        let dias=Math.floor((hoje-s.d)/(1000*60*60*24));
        if(dias>=90){ vencidos++; htmlOleo+=`<div class="list-item" style="border-left-color:red"><span>${s.p} - ${s.n} (${dias} dias)</span><i class="fab fa-whatsapp" onclick="window.open('https://api.whatsapp.com/send?phone=${s.z}&text=OlÃ¡! JÃ¡ faz 3 meses da Ãºltima troca de Ã³leo. Vamos agendar?')"></i></div>`; }
      }
    });
    document.getElementById('notif-oleo').innerText=vencidos;
    document.getElementById('notif-oleo').style.display=vencidos>0?'block':'none';
    document.getElementById('lista-oleo').innerHTML=htmlOleo||"Sem trocas pendentes.";

    // GrÃ¡fico
    const ctx=document.getElementById('chartFin').getContext('2d');
    if(chart) chart.destroy();
    chart=new Chart(ctx,{
      type:'doughnut',
      data:{labels:['Lucro LÃ­quido','Contas','PeÃ§as'],datasets:[{data:[lucro>0?lucro:0,db.contas,db.pecas],backgroundColor:['#00f298','#ff4b5c','#00d2ff']}]},
      options:{plugins:{legend:{labels:{color:'white'}}}}
    });
  }

  function analisarIA(){
    let lucro=db.mao-db.contas;
    let analise="";
    if(lucro<=0) analise="âš ï¸ ALERTA: VocÃª estÃ¡ pagando para trabalhar!";
    else if(db.contas>db.mao*0.5) analise="âš ï¸ CUIDADO: Despesas >50% do lucro!";
    else analise="âœ… Lucro saudÃ¡vel: R$ "+lucro.toFixed(2);
    document.getElementById('ia-res').innerText=analise+"\n\nğŸ’¡ Dica: "+(db.servicos.length<5?"Cadastre mais serviÃ§os para anÃ¡lise precisa.":"Use a lista de Ã³leo para clientes antigos.");
  }

  function zapOrcamento(){ window.open(`https://api.whatsapp.com/send?phone=${sCel.value}&text=OrÃ§amento: MÃ£o de Obra R$ ${sMao.value}, PeÃ§as R$ ${sPec.value}, Total R$ ${parseFloat(sMao.value)+parseFloat(sPec.value)}`); }
  function gerarPDF(){ const { jsPDF } = window.jspdf; const doc=new jsPDF(); doc.text("RelatÃ³rio Lisboa Pro",10,10); doc.text(`Lucro: R$ ${db.mao-db.contas}`,10,20); doc.save("mes.pdf"); }
  function calcTaxa(){ alert("Cobrar R$ "+(taxV.value*1.12).toFixed(2)+" para receber R$ "+taxV.value); }
  function resetMes(){ if(confirm("Zerar ganhos do mÃªs?")){ db.mao=0; db.contas=0; db.pecas=0; save(); } }
  function gerarBackup(){ txtBack.value=btoa(JSON.stringify(db)); }

  render();
</script>
</body>
</html>
