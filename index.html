<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LISBOA PRO - OFICINA SUPER</title>

<!-- Bibliotecas -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
:root{
  --bg:#0a0e17; --card:#161b28; --primary:#2a5ee8; --accent:#00d2ff;
  --success:#00f298; --danger:#ff4b5c; --text:#e1e8f0;
}
body{
  margin:0; font-family:'Inter',sans-serif; background:var(--bg); color:var(--text);
  padding-bottom:80px;
}
.header{background:var(--card); padding:20px; text-align:center; border-bottom:1px solid rgba(255,255,255,0.1);}
.header img{max-width:130px;}

/* Toast notificaÃ§Ãµes */
#toast{
  visibility:hidden;
  min-width:200px;
  margin-left:-100px;
  background-color:#333;
  color:#fff;
  text-align:center;
  border-radius:8px;
  padding:10px;
  position:fixed;
  z-index:9999;
  left:50%;
  bottom:30px;
  font-size:14px;
  opacity:0;
  transition:opacity 0.5s,visibility 0.5s;
}
#toast.show{visibility:visible; opacity:1;}

/* Container */
.container{padding:15px; max-width:600px; margin:auto;}

/* Cards */
.card{background:var(--card); padding:20px; border-radius:20px; margin-bottom:15px; border:1px solid rgba(255,255,255,0.05);}

/* Balance Card */
.balance-val{font-size:2.5rem; font-weight:800; color:var(--success); margin:10px 0;}
.balance-card h2{margin:0; font-size:0.8rem; text-transform:uppercase; letter-spacing:1px; opacity:0.7;}

/* Menu Grid */
.menu-grid{display:grid; grid-template-columns:repeat(4,1fr); gap:10px; margin-bottom:20px;}
.menu-item{background:var(--card); padding:12px 5px; border-radius:16px; text-align:center; border:1px solid rgba(255,255,255,0.05); cursor:pointer; transition:0.2s;}
.menu-item i{font-size:1.2rem; color:var(--accent); margin-bottom:6px; display:block;}
.menu-item span{font-size:0.55rem; font-weight:700; text-transform:uppercase;}
.menu-item:active{transform:scale(0.9); background:var(--primary);}

/* Sections */
.section{display:none;}
.active{display:block; animation:slideIn 0.3s ease-out;}
@keyframes slideIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}

input, select, textarea{
  background:#0f141e; border:1px solid #2d364a; color:white;
  padding:12px; border-radius:12px; width:100%; margin:8px 0; box-sizing:border-box;
}
button{
  background:var(--primary); color:white; padding:14px; border-radius:14px; border:none;
  font-weight:700; width:100%; cursor:pointer; margin-top:5px; font-size:14px; transition:0.2s;
}
button:active{opacity:0.8;}
.btn-success{background:var(--success); color:#0a0e17;}
.btn-danger{background:var(--danger);}

.list-item{background:rgba(255,255,255,0.03); padding:12px; border-radius:16px; margin-bottom:8px; display:flex; justify-content:space-between; align-items:center; border-left:4px solid var(--primary);}
.badge{background:var(--danger); color:white; border-radius:50px; padding:2px 8px; font-size:10px; position:absolute; top:-5px; right:-5px;}

.ia-box{background:#000; border:1px solid var(--success); padding:12px; border-radius:12px; font-family:'Courier New', monospace; color:var(--success); font-size:13px; line-height:1.4;}
</style>
</head>

<body>
<div id="toast"></div>

<div class="header">
  <img src="B1BCC237-7C89-4142-8131-6DA05C2A2C61 2.png" alt="Lisboa Pro">
</div>

<!-- Login -->
<div id="loginPage" class="container">
  <div class="balance-card">
    <h3>ACESSO RESTRITO</h3>
    <input id="senha" type="password" placeholder="Senha Administrativa">
    <button id="btnLogin">ENTRAR NO PAINEL</button>
  </div>
</div>

<!-- Main Page -->
<div id="mainPage" class="container" style="display:none;">

<!-- Dashboard -->
<div class="balance-card">
  <h2>Saldo Real (Lucro LÃ­quido)</h2>
  <div class="balance-val" id="val-lucro">R$ 0,00</div>
  <div style="display:flex; justify-content:space-around; opacity:0.8; font-size:12px;">
    <span>MÃ£o de Obra: <b id="val-mao" style="color:var(--accent)">R$ 0</b></span>
    <span>Contas: <b id="val-contas" style="color:var(--danger)">R$ 0</b></span>
  </div>
</div>

<!-- Menu -->
<div class="menu-grid">
  <div class="menu-item" onclick="nav('sec-dash')"><i class="fas fa-chart-line"></i><span>Dash</span></div>
  <div class="menu-item" onclick="nav('sec-serv')"><i class="fas fa-plus"></i><span>Novo</span></div>
  <div class="menu-item" onclick="nav('sec-contas')"><i class="fas fa-receipt"></i><span>Contas</span></div>
  <div class="menu-item" onclick="nav('sec-hist')"><i class="fas fa-search"></i><span>HistÃ³rico</span></div>
  <div class="menu-item" onclick="nav('sec-oleo')" style="position:relative;">
    <i class="fas fa-oil-can"></i><span>Ã“leo</span>
    <span id="notif-oleo" class="badge" style="display:none">0</span>
  </div>
</div>

<!-- SeÃ§Ãµes: Dash -->
<div id="sec-dash" class="card section active">
  <h3>ğŸ“Š Resumo Financeiro</h3>
  <canvas id="chartFin" height="200"></canvas>
  <button onclick="gerarPDF()" class="btn-success"><i class="fas fa-file-pdf"></i> Gerar RelatÃ³rio PDF</button>
  <button onclick="resetMes()" class="btn-danger">ğŸ”„ Resetar Ganhos</button>
</div>

<!-- SeÃ§Ãµes: ServiÃ§os -->
<div id="sec-serv" class="card section">
  <h3>ğŸ”§ Novo ServiÃ§o</h3>
  <input id="sNome" placeholder="Nome do Cliente">
  <input id="sPlaca" placeholder="Placa">
  <input id="sCel" placeholder="Celular (WhatsApp)">
  <input id="sMao" type="number" placeholder="MÃ£o de Obra (Lucro)">
  <input id="sPec" type="number" placeholder="PeÃ§as (Custo)">
  <select id="sOleo">
    <option value="nao">Troca de Ã“leo? NÃ£o</option>
    <option value="sim">Sim - Avisar em 90 dias</option>
  </select>
  <button onclick="salvarServico()" class="btn-success">ğŸ’¾ Salvar ServiÃ§o</button>
  <button onclick="zapOrcamento()">ğŸ“± Enviar OrÃ§amento</button>
</div>

<!-- SeÃ§Ãµes: Contas -->
<div id="sec-contas" class="card section">
  <h3>ğŸ’¸ Contas e Despesas</h3>
  <input id="cDesc" placeholder="DescriÃ§Ã£o da Conta">
  <input id="cVal" type="number" placeholder="Valor R$">
  <button onclick="salvarConta()" class="btn-danger">ğŸ’° Pagar Conta</button>
  <div id="lista-contas"></div>
</div>

<!-- SeÃ§Ãµes: HistÃ³rico -->
<div id="sec-hist" class="card section">
  <h3>ğŸ“‚ HistÃ³rico</h3>
  <input id="busca" placeholder="Buscar por placa..." onkeyup="render()">
  <div id="lista-hist"></div>
</div>

<!-- SeÃ§Ãµes: Ã“leo -->
<div id="sec-oleo" class="card section">
  <h3>ğŸ›¢ï¸ Lembretes de Ã“leo</h3>
  <div id="lista-oleo">Nenhum alerta</div>
</div>
<!-- SeÃ§Ãµes: Estoque -->
<div id="sec-estoque" class="card section">
  <h3>ğŸ“¦ Estoque</h3>
  <input id="eN" placeholder="PeÃ§a">
  <input id="eQ" type="number" placeholder="Quantidade">
  <button onclick="addObj('estoque','eN','eQ')">â• Adicionar</button>
  <div id="l-estoque"></div>
</div>

<!-- SeÃ§Ãµes: Tabela de PreÃ§os -->
<div id="sec-tabela" class="card section">
  <h3>ğŸ“‹ Tabela de PreÃ§os</h3>
  <input id="tN" placeholder="ServiÃ§o">
  <input id="tV" placeholder="Valor R$">
  <button onclick="addObj('tabela','tN','tV')">â• Adicionar</button>
  <div id="l-tabela"></div>
</div>

<!-- SeÃ§Ãµes: Taxas -->
<div id="sec-taxa" class="card section">
  <h3>ğŸ’³ Calculadora de Taxas</h3>
  <input id="taxV" type="number" placeholder="Valor do ServiÃ§o">
  <button onclick="calcTaxa()">ğŸ’¸ Calcular (+12%)</button>
</div>

<!-- SeÃ§Ãµes: Agenda -->
<div id="sec-agenda" class="card section">
  <h3>ğŸ“… Agenda de Retorno</h3>
  <input id="aN" placeholder="Cliente">
  <input id="aD" type="date">
  <button onclick="addObj('agenda','aN','aD')">ğŸ—“ï¸ Agendar</button>
  <div id="l-agenda"></div>
</div>

<!-- SeÃ§Ãµes: Compras -->
<div id="sec-compras" class="card section">
  <h3>ğŸ›’ Lista de Compras</h3>
  <input id="cpN" placeholder="Item faltando">
  <button onclick="addObj('compras','cpN')">â• Adicionar</button>
  <div id="l-compras"></div>
</div>

<!-- SeÃ§Ãµes: Check-list -->
<div id="sec-check" class="card section">
  <h3>ğŸ“‹ Check-list Entrada</h3>
  <input id="chP" placeholder="Placa">
  <textarea id="chD" placeholder="ObservaÃ§Ãµes/Avarias"></textarea>
  <button onclick="addObj('check','chP','chD')">ğŸ’¾ Salvar</button>
  <div id="l-check"></div>
</div>

<!-- SeÃ§Ãµes: Analista IA -->
<div id="sec-ia" class="card section">
  <h3>ğŸ¤– Analista Inteligente</h3>
  <div id="ia-res" class="ia-box">Aguardando dados...</div>
  <button onclick="analisarIA()">âš¡ Gerar DiagnÃ³stico</button>
  <hr style="opacity:0.1; margin:15px 0">
  <button onclick="gerarBackup()" style="background:#333;">ğŸ’¾ Gerar Backup</button>
  <textarea id="txtBack" style="width:100%; height:50px; font-size:8px;"></textarea>
</div>

<script>
/* ========================================
Banco de dados centralizado
======================================== */
let db = JSON.parse(localStorage.getItem('lisboa_vfinal')) || {
  mao:0, contas:0, pecas:0,
  servicos:[], despesas:[],
  estoque:[], tabela:[], agenda:[], compras:[], check:[]
};
let chart;

/* ========================================
FunÃ§Ãµes Gerais
======================================== */
function save(){ localStorage.setItem('lisboa_vfinal', JSON.stringify(db)); render(); }

function showToast(msg){
  const t=document.getElementById('toast');
  t.innerText=msg;
  t.className="show";
  setTimeout(()=>{t.className="";},3000);
}

function login(){
  const pass=document.getElementById('senha').value;
  if(pass==='1234'){
    document.getElementById('loginPage').style.display='none';
    document.getElementById('mainPage').style.display='block';
    render();
    showToast("âœ… Bem-vindo ao painel!");
  } else showToast("âŒ Senha incorreta!");
}

document.getElementById('btnLogin').onclick=login;

function nav(id){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

/* ========================================
ServiÃ§os
======================================== */
function salvarServico(){
  let m=parseFloat(document.getElementById('sMao').value)||0;
  let p=parseFloat(document.getElementById('sPec').value)||0;
  if(m+p>0){
    db.mao+=m; db.pecas+=p;
    db.servicos.unshift({
      n:document.getElementById('sNome').value,
      p:document.getElementById('sPlaca').value.toUpperCase(),
      v:m+p, m:m, pe:p,
      z:document.getElementById('sCel').value,
      ol:document.getElementById('sOleo').value,
      d:new Date().getTime()
    });
    document.getElementById('sNome').value='';
    document.getElementById('sPlaca').value='';
    document.getElementById('sMao').value='';
    document.getElementById('sPec').value='';
    document.getElementById('sCel').value='';
    save(); showToast("ğŸ’¾ ServiÃ§o salvo!");
  } else showToast("âš ï¸ Preencha valores vÃ¡lidos!");
}

function zapOrcamento(){
  let sCel=document.getElementById('sCel').value;
  let sMao=document.getElementById('sMao').value;
  let sPec=document.getElementById('sPec').value;
  window.open(`https://api.whatsapp.com/send?phone=${sCel}&text=OlÃ¡! OrÃ§amento Lisboa: MÃ£o de Obra R$ ${sMao}, PeÃ§as R$ ${sPec}. Total R$ ${parseFloat(sMao)+parseFloat(sPec)}`);
}

/* ========================================
Contas
======================================== */
function salvarConta(){
  let v=parseFloat(document.getElementById('cVal').value)||0;
  if(v>0){
    db.contas+=v;
    db.despesas.unshift({n:document.getElementById('cDesc').value, v:v, d:new Date().toLocaleDateString()});
    document.getElementById('cVal').value=''; document.getElementById('cDesc').value='';
    save(); showToast("ğŸ’° Conta adicionada!");
  } else showToast("âš ï¸ Valor invÃ¡lido!");
}

/* ========================================
Objetos genÃ©ricos (Estoque, Tabela, Agenda, Compras, Check)
======================================== */
function addObj(t,id1,id2){
  let obj={n:document.getElementById(id1).value};
  if(id2) obj.v=document.getElementById(id2).value;
  db[t].push(obj);
  document.getElementById(id1).value='';
  if(id2) document.getElementById(id2).value='';
  save(); showToast("âœ… Adicionado em "+t);
}

/* ========================================
RenderizaÃ§Ã£o dinÃ¢mica
======================================== */
function render(){
  // Lucro
  let lucro=db.mao-db.contas;
  document.getElementById('val-lucro').innerText="R$ "+lucro.toFixed(2);
  document.getElementById('val-mao').innerText="R$ "+db.mao.toFixed(2);
  document.getElementById('val-contas').innerText="R$ "+db.contas.toFixed(2);

  // HistÃ³rico
  let busca=document.getElementById('busca')?document.getElementById('busca').value.toUpperCase():'';
  document.getElementById('lista-hist').innerHTML=db.servicos.filter(s=>s.p.includes(busca)).map(s=>`<div class="list-item"><span><b>${s.p}</b> - ${s.n}</span><b>R$ ${s.v}</b></div>`).join('');
  document.getElementById('lista-contas').innerHTML=db.despesas.map(d=>`<div class="list-item"><span>${d.n}</span><b style="color:red">- R$ ${d.v}</b></div>`).join('');

  // Ã“leo vencido
  let hoje=new Date().getTime(); let vencidos=0; let htmlOleo="";
  db.servicos.forEach(s=>{
    if(s.ol==='sim'){
      let dias=Math.floor((hoje-s.d)/(1000*60*60*24));
      if(dias>=90){
        vencidos++;
        htmlOleo+=`<div class="list-item" style="border-left-color:red"><span>${s.p} - ${s.n} (${dias} dias)</span><i class="fab fa-whatsapp" onclick="window.open('https://api.whatsapp.com/send?phone=${s.z}&text=OlÃ¡! JÃ¡ faz 3 meses da Ãºltima troca de Ã³leo. Vamos agendar?')"></i></div>`;
      }
    }
  });
  let notif=document.getElementById('notif-oleo');
  notif.innerText=vencidos;
  notif.style.display=vencidos>0?'block':'none';
  document.getElementById('lista-oleo').innerHTML=htmlOleo||"Sem trocas pendentes.";

  // GrÃ¡fico Doughnut
  const ctx=document.getElementById('chartFin').getContext('2d');
  if(chart) chart.destroy();
  chart=new Chart(ctx,{type:'doughnut',data:{labels:['Lucro','Contas','PeÃ§as'],datasets:[{data:[lucro>0?lucro:0,db.contas,db.pecas],backgroundColor:['#00f298','#ff4b5c','#00d2ff'],borderWidth:0}]},options:{plugins:{legend:{labels:{color:'white'}}}}});
}

/* ========================================
IA - Analista Financeiro
======================================== */
function analisarIA(){
  let lucro=db.mao-db.contas;
  let analise="";
  if(lucro<=0) analise="âŒ ALERTA CRÃTICO: Gastos superam lucro!";
  else if(db.contas>db.mao*0.5) analise="âš ï¸ CUIDADO: Despesas > 50% do lucro!";
  else analise="âœ… SAÃšDE Ã“TIMA: Lucro R$ "+lucro.toFixed(2);
  document.getElementById('ia-res').innerText=analise+"\n\nğŸ’¡ DICA: "+(db.servicos.length<5?"Cadastre mais serviÃ§os para anÃ¡lise precisa.":"Use a lista de Ã³leo para atrair clientes antigos.");
}

/* ========================================
FunÃ§Ãµes Extras
======================================== */
function gerarPDF(){
  const {jsPDF}=window.jspdf;
  const doc=new jsPDF();
  doc.text("RelatÃ³rio Lisboa Pro",10,10);
  doc.text(`Lucro: R$ ${db.mao-db.contas}`,10,20);
  doc.save("mes.pdf");
}

function calcTaxa(){
  const val=parseFloat(document.getElementById('taxV').value)||0;
  alert("Para receber livre R$ "+val+", cobre do cliente R$ "+(val*1.12).toFixed(2));
}

function resetMes(){
  if(confirm("Deseja zerar ganhos do mÃªs?")){
    db.mao=0; db.contas=0; db.pecas=0;
    save(); showToast("ğŸ”„ Ganhos zerados!");
  }
}

function gerarBackup(){
  document.getElementById('txtBack').value=btoa(JSON.stringify(db));
}

// Inicializa renderizaÃ§Ã£o ao carregar
render();
</script>
</body>
</html>
