<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Oficina Wesley Lisboa</title>

<link rel="stylesheet" href="style.css">

<script defer src="app.js"></script>
<script defer src="financeiro.js"></script>
<script defer src="estoque.js"></script>
<script defer src="oleo.js"></script>
<script defer src="relatorios.js"></script>
<script defer src="backup.js"></script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox" class="loginBox">
  <img src="B1BCC237-7C89-4142-8131-6DA05C2A2C61%202.png" class="logoLogin">
  <h2>ðŸ”’ Oficina Wesley Lisboa</h2>
  <input type="password" id="senhaLogin" placeholder="Senha">
  <button onclick="login()">Entrar</button>
</div>

<!-- SISTEMA -->
<div id="app" style="display:none">

<header class="topo">
  <img src="B1BCC237-7C89-4142-8131-6DA05C2A2C61%202.png" class="logoTopo">
</header>

<section class="saldoBox">
  <p>SALDO REAL</p>
  <h1 id="saldoTotal">R$ 0,00</h1>

  <div class="infoLinha">
    <span>MÃ£o de obra: <b id="maoObra">0</b></span>
    <span>Contas: <b id="contasTotal">0</b></span>
    <span>Meta: <b id="metaMensal">5000</b></span>
  </div>
</section>

<!-- MENU -->
<div class="menuGrid">
  <button onclick="showSection('dash')">ðŸ“Š Dashboard</button>
  <button onclick="showSection('novo')">âž• Novo ServiÃ§o</button>
  <button onclick="showSection('contas')">ðŸ’¸ Contas</button>
  <button onclick="showSection('historico')">ðŸ“œ HistÃ³rico</button>
  <button onclick="showSection('oleo')">ðŸ›¢ Ã“leo</button>
  <button onclick="showSection('estoque')">ðŸ“¦ Estoque</button>
  <button onclick="showSection('agenda')">ðŸ“… Agenda</button>
  <button onclick="showSection('metas')">ðŸŽ¯ Metas</button>
</div>

<!-- DASH -->
<div id="dash" class="section active">
  <h3>Resumo Financeiro</h3>
  <canvas id="graficoResumo"></canvas>
</div>

<!-- NOVO SERVIÃ‡O -->
<div id="novo" class="section">
  <h3>Novo ServiÃ§o</h3>
  <input id="cliente" placeholder="Cliente">
  <input id="placa" placeholder="Placa">
  <input id="valor" type="number" placeholder="Valor R$">

  <select id="pagamento">
    <option>Pix</option>
    <option>CrÃ©dito</option>
    <option>DÃ©bito</option>
    <option>Dinheiro</option>
  </select>

  <button onclick="addServico()">Salvar</button>
</div>

<!-- CONTAS -->
<div id="contas" class="section">
  <h3>Contas Fixas</h3>
  <input id="contaNome" placeholder="Conta">
  <input id="contaValor" type="number" placeholder="Valor">
  <button onclick="addConta()">Salvar Conta</button>
  <div id="listaContas"></div>
</div>

<!-- HISTÃ“RICO -->
<div id="historico" class="section">
  <h3>HistÃ³rico</h3>
  <input id="filtroBusca" placeholder="Buscar cliente ou placa">
  <button onclick="buscar()">Buscar</button>
  <div id="listaServicos"></div>
</div>

<!-- Ã“LEO -->
<div id="oleo" class="section">
  <h3>Controle de Ã“leo</h3>
  <input id="oleoPlaca" placeholder="Placa">
  <input id="oleoAtual" placeholder="KM atual">
  <input id="oleoProx" placeholder="PrÃ³xima troca KM">
  <button onclick="addOleo()">Salvar</button>
  <div id="listaOleo"></div>
</div>

<!-- ESTOQUE -->
<div id="estoque" class="section">
  <h3>Estoque</h3>
  <input id="pecaNome" placeholder="PeÃ§a">
  <input id="pecaQtd" type="number" placeholder="Quantidade">
  <button onclick="addPeca()">Salvar</button>
  <div id="listaEstoque"></div>
</div>

<!-- AGENDA -->
<div id="agenda" class="section">
  <h3>Agenda</h3>
  <input id="agendaCliente" placeholder="Cliente">
  <input id="agendaData" type="date">
  <button onclick="addAgenda()">Salvar</button>
  <div id="listaAgenda"></div>
</div>

<!-- METAS -->
<div id="metas" class="section">
  <h3>Meta Mensal</h3>
  <input id="novaMeta" type="number" placeholder="Valor da meta">
  <button onclick="salvarMeta()">Salvar Meta</button>
</div>

</div>
</body>
</html>
/* RESET */
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
}
/* FUNDO */
body{
  background:linear-gradient(180deg,#0b0f1a,#111827);
  color:white;
  min-height:100vh;
}
/* LOGIN */
.loginBox{
  position:fixed;
  inset:0;
  background:#0b0f1a;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:15px;
  z-index:9999;
}
.logoLogin{
  width:130px;
  border-radius:15px;
}
.loginBox h2{
  font-size:20px;
  margin-bottom:10px;
}
.loginBox input{
  width:80%;
  padding:12px;
  border-radius:10px;
  border:none;
  background:#111827;
  color:white;
  outline:none;
  font-size:16px;
}
.loginBox button{
  padding:12px 30px;
  background:#2563eb;
  border:none;
  border-radius:12px;
  color:white;
  font-size:16px;
  font-weight:bold;
  transition:0.2s;
}
.loginBox button:active{
  transform:scale(0.95);
}
/* TOPO */
.topo{
  text-align:center;
  padding:15px;
  background:#0b0f1a;
  border-bottom:1px solid #1f2933;
}
.logoTopo{
  width:160px;
  border-radius:15px;
}
/* SALDO */
.saldoBox{
  text-align:center;
  padding:15px;
  background:#111827;
  border-radius:15px;
  margin:10px;
  box-shadow:0 0 20px rgba(0,0,0,0.5);
}
.saldoBox p{
  font-size:14px;
  color:#9ca3af;
}
.saldoBox h1{
  font-size:30px;
  color:#22c55e;
  margin:5px 0;
}
.infoLinha{
  display:flex;
  justify-content:space-between;
  font-size:12px;
  color:#9ca3af;
}
/* MENU */
.menuGrid{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:8px;
  padding:10px;
}
.menuGrid button{
  background:#111827;
  border:none;
  border-radius:12px;
  padding:12px 5px;
  color:white;
  font-size:12px;
  font-weight:bold;
  box-shadow:0 0 10px rgba(0,0,0,0.4);
  transition:0.2s;
}
.menuGrid button:hover{
  background:#1f2937;
}

.menuGrid button:active{
  transform:scale(0.95);
  background:#2563eb;
}

/* SEÃ‡Ã•ES */
.section{
  display:none;
  padding:12px;
}

.section.active{
  display:block;
}

/* INPUTS */
input, select{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  background:#111827;
  color:white;
  margin-top:8px;
  outline:none;
}

/* BOTÃ•ES GERAIS */
.section button{
  width:100%;
  margin-top:10px;
  padding:12px;
  border-radius:12px;
  border:none;
  background:#2563eb;
  color:white;
  font-weight:bold;
  font-size:15px;
  transition:0.2s;
}

.section button:active{
  transform:scale(0.95);
  background:#1d4ed8;
}

/* LISTAS */
#listaServicos, #listaContas, #listaOleo, #listaEstoque, #listaAgenda{
  margin-top:10px;
  display:flex;
  flex-direction:column;
  gap:8px;
}

.card{
  background:#111827;
  padding:10px;
  border-radius:12px;
  font-size:13px;
  box-shadow:0 0 10px rgba(0,0,0,0.4);
}

/* ALERTAS */
.badge{
  padding:2px 6px;
  border-radius:6px;
  font-size:11px;
  font-weight:bold;
}

.badge.red{background:#dc2626;}
.badge.yellow{background:#facc15;color:black;}
.badge.green{background:#22c55e;color:black;}

/* GRÃFICO */
canvas{
  background:#111827;
  border-radius:15px;
  padding:10px;
}

/* POPUP ALERTA */
.alertPopup{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  background:#2563eb;
  padding:12px 20px;
  border-radius:12px;
  color:white;
  font-weight:bold;
  box-shadow:0 0 20px rgba(0,0,0,0.6);
  z-index:99999;
}
// ================= LOGIN =================
const SENHA_FIXA = "2026"; // depois podemos fazer mÃºltiplos usuÃ¡rios

function login() {
  const senha = document.getElementById("senhaLogin").value;
  if (senha === SENHA_FIXA) {
    localStorage.setItem("logado", "true");
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("app").style.display = "block";
  } else {
    alert("Senha incorreta!");
  }
}

// Auto login
window.addEventListener("load", () => {
  if (localStorage.getItem("logado") === "true") {
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("app").style.display = "block";
  }
  carregarDados();
  atualizarSaldo();
});

// ================= NAVEGAÃ‡ÃƒO =================
function showSection(id) {
  document.querySelectorAll(".section").forEach(sec => sec.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

// ================= BANCO DE DADOS LOCAL =================
let servicos = JSON.parse(localStorage.getItem("servicos")) || [];
let contas = JSON.parse(localStorage.getItem("contas")) || [];
let oleos = JSON.parse(localStorage.getItem("oleos")) || [];
let estoque = JSON.parse(localStorage.getItem("estoque")) || [];
let agenda = JSON.parse(localStorage.getItem("agenda")) || [];
let meta = localStorage.getItem("meta") || 5000;

// ================= SALVAR AUTOMÃTICO =================
function salvarTudo() {
  localStorage.setItem("servicos", JSON.stringify(servicos));
  localStorage.setItem("contas", JSON.stringify(contas));
  localStorage.setItem("oleos", JSON.stringify(oleos));
  localStorage.setItem("estoque", JSON.stringify(estoque));
  localStorage.setItem("agenda", JSON.stringify(agenda));
  localStorage.setItem("meta", meta);
}

// ================= CARREGAR DADOS =================
function carregarDados() {
  atualizarListas();
  document.getElementById("metaMensal").innerText = "R$ " + meta;
}

// ================= SALDO =================
function atualizarSaldo() {
  let totalServicos = servicos.reduce((s, x) => s + Number(x.valor), 0);
  let totalContas = contas.reduce((s, x) => s + Number(x.valor), 0);
  let saldo = totalServicos - totalContas;

  document.getElementById("saldoTotal").innerText = "R$ " + saldo.toFixed(2);
  document.getElementById("maoObra").innerText = "R$ " + totalServicos.toFixed(2);
  document.getElementById("contasTotal").innerText = "R$ " + totalContas.toFixed(2);
}

// ================= SERVIÃ‡OS =================
function addServico() {
  const cliente = document.getElementById("cliente").value;
  const placa = document.getElementById("placa").value;
  const valor = document.getElementById("valor").value;
  const pagamento = document.getElementById("pagamento").value;

  if (!cliente || !valor) return alert("Preencha tudo");

  servicos.push({ cliente, placa, valor, pagamento, data: new Date().toLocaleDateString() });
  salvarTudo();
  atualizarListas();
  atualizarSaldo();
  alert("ServiÃ§o salvo!");
}

// ================= CONTAS =================
function addConta() {
  const nome = document.getElementById("contaNome").value;
  const valor = document.getElementById("contaValor").value;
  if (!nome || !valor) return;

  contas.push({ nome, valor });
  salvarTudo();
  atualizarListas();
  atualizarSaldo();
}

// ================= Ã“LEO =================
function addOleo() {
  const placa = document.getElementById("oleoPlaca").value;
  const atual = document.getElementById("oleoAtual").value;
  const prox = document.getElementById("oleoProx").value;

  oleos.push({ placa, atual, prox });
  salvarTudo();
  atualizarListas();
}

// ================= ESTOQUE =================
function addPeca() {
  const nome = document.getElementById("pecaNome").value;
  const qtd = document.getElementById("pecaQtd").value;

  estoque.push({ nome, qtd });
  salvarTudo();
  atualizarListas();
}

// ================= AGENDA =================
function addAgenda() {
  const cliente = document.getElementById("agendaCliente").value;
  const data = document.getElementById("agendaData").value;

  agenda.push({ cliente, data });
  salvarTudo();
  atualizarListas();
}

// ================= META =================
function salvarMeta() {
  meta = document.getElementById("novaMeta").value;
  localStorage.setItem("meta", meta);
  document.getElementById("metaMensal").innerText = "R$ " + meta;
}

// ================= LISTAS =================
function atualizarListas() {
  // ServiÃ§os
  let s = document.getElementById("listaServicos");
  if (s) {
    s.innerHTML = "";
    servicos.forEach(x => {
      s.innerHTML += `<div class="card">${x.cliente} | ${x.placa} | R$ ${x.valor} | ${x.pagamento}</div>`;
    });
  }

  // Contas
  let c = document.getElementById("listaContas");
  if (c) {
    c.innerHTML = "";
    contas.forEach(x => {
      c.innerHTML += `<div class="card">${x.nome} - R$ ${x.valor}</div>`;
    });
  }

  // Ã“leo
  let o = document.getElementById("listaOleo");
  if (o) {
    o.innerHTML = "";
    oleos.forEach(x => {
      let alerta = Number(x.prox) <= Number(x.atual) ? "red" : "green";
      o.innerHTML += `<div class="card">Placa: ${x.placa} <span class="badge ${alerta}">Trocar</span></div>`;
    });
  }

  // Estoque
  let e = document.getElementById("listaEstoque");
  if (e) {
    e.innerHTML = "";
    estoque.forEach(x => {
      let alerta = x.qtd < 5 ? "red" : "green";
      e.innerHTML += `<div class="card">${x.nome} - ${x.qtd} <span class="badge ${alerta}">Qtd</span></div>`;
    });
  }

  // Agenda
  let a = document.getElementById("listaAgenda");
  if (a) {
    a.innerHTML = "";
    agenda.forEach(x => {
      a.innerHTML += `<div class="card">${x.cliente} - ${x.data}</div>`;
    });
  }
}

// ================= BUSCA HISTÃ“RICO =================
function buscar() {
  const f = document.getElementById("filtroBusca").value.toLowerCase();
  let s = document.getElementById("listaServicos");
  s.innerHTML = "";
  servicos.filter(x => x.cliente.toLowerCase().includes(f) || x.placa.toLowerCase().includes(f))
    .forEach(x => {
      s.innerHTML += `<div class="card">${x.cliente} | ${x.placa} | R$ ${x.valor}</div>`;
    });
}
// ================= RESUMO POR PAGAMENTO =================
function resumoPagamento() {
  let resumo = { Pix: 0, CrÃ©dito: 0, DÃ©bito: 0, Dinheiro: 0 };

  servicos.forEach(s => {
    resumo[s.pagamento] += Number(s.valor);
  });

  console.log("Resumo:", resumo);
  return resumo;
}
function checarOleo() {
  oleos.forEach(o => {
    if (Number(o.atual) >= Number(o.prox)) {
      popup("âš ï¸ Troca de Ã³leo vencida: " + o.placa, "red");
    }
  });
}

setInterval(checarOleo, 5000);
function checarEstoque() {
  estoque.forEach(p => {
    if (Number(p.qtd) <= 3) {
      popup("ðŸ“¦ Estoque baixo: " + p.nome, "yellow");
    }
  });
}

setInterval(checarEstoque, 5000);
let grafico;

function gerarGrafico() {
  const ctx = document.getElementById("graficoResumo");
  if (!ctx) return;

  let meses = {};
  servicos.forEach(s => {
    let mes = s.data.split("/")[1] || "Hoje";
    meses[mes] = (meses[mes] || 0) + Number(s.valor);
  });

  let labels = Object.keys(meses);
  let valores = Object.values(meses);

  if (grafico) grafico.destroy();

  grafico = new Chart(ctx, {
    type: "bar",
    data: {
      labels,
      datasets: [{
        label: "Lucro Mensal",
        data: valores,
        backgroundColor: "#22c55e"
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { labels: { color: "white" } }
      },
      scales: {
        x: { ticks: { color: "white" } },
        y: { ticks: { color: "white" } }
      }
    }
  });
}

setInterval(gerarGrafico, 5000);
function backupAuto() {
  let backup = {
    servicos, contas, oleos, estoque, agenda, meta
  };
  localStorage.setItem("backup_oficina", JSON.stringify(backup));
}

setInterval(backupAuto, 10000);

function restaurarBackup() {
  let b = JSON.parse(localStorage.getItem("backup_oficina"));
  if (!b) return alert("Sem backup");
  servicos = b.servicos;
  contas = b.contas;
  oleos = b.oleos;
  estoque = b.estoque;
  agenda = b.agenda;
  meta = b.meta;
  salvarTudo();
  atualizarListas();
  atualizarSaldo();
  alert("Backup restaurado!");
}
function popup(msg, cor="blue") {
  let p = document.createElement("div");
  p.className = "alertPopup";
  p.style.background = cor == "red" ? "#dc2626" : cor == "yellow" ? "#facc15" : "#2563eb";
  p.innerText = msg;
  document.body.appendChild(p);

  setTimeout(()=>p.remove(), 4000);
}
