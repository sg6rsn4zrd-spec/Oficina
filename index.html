<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISTEMA LISBOA PRO - ELITE V12</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #1b4a9c; --accent: #00b4ff; --success: #00ff9d; --danger: #ff4b2b; --dark: #0a192f; --card: #112240; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--dark); color: white; padding-bottom: 50px; }
        .header-logo { text-align: center; padding: 15px; background: #112240; border-bottom: 3px solid var(--primary); }
        .main-logo { max-width: 180px; filter: drop-shadow(0 0 8px var(--accent)); }
        .container { padding: 12px; max-width: 850px; margin: auto; }
        
        /* Grid de 12 Bot√µes Reais */
        .menu-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 20px; }
        .menu-item { background: var(--card); padding: 15px 5px; border-radius: 15px; text-align: center; border: 1px solid var(--primary); cursor: pointer; transition: 0.3s; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        .menu-item i { font-size: 1.6rem; color: var(--accent); margin-bottom: 8px; display: block; }
        .menu-item span { font-size: 0.7rem; font-weight: bold; text-transform: uppercase; display: block; letter-spacing: 0.5px; }
        .menu-item:active { background: var(--primary); transform: translateY(3px); }

        .card { background: var(--card); padding: 22px; border-radius: 20px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.1); display: none; box-shadow: 0 10px 20px rgba(0,0,0,0.4); }
        .active-section { display: block !important; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        h3 { color: var(--accent); margin-top: 0; font-size: 1.2rem; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; margin-bottom: 15px; }
        input, select, textarea { background: #0d1f33; border: 1px solid #1e3a5a; color: white; padding: 14px; border-radius: 10px; width: 100%; box-sizing: border-box; margin: 6px 0; font-size: 16px; outline: none; }
        input:focus { border-color: var(--accent); box-shadow: 0 0 8px var(--accent); }
        
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        button { padding: 15px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; width: 100%; transition: 0.3s; font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-add { background: var(--success); color: var(--dark); }
        .btn-blue { background: var(--primary); color: white; }
        .btn-del { background: var(--danger); color: white; }
        .btn-wpp { background: #25d366; color: white; }
        
        .item-lista { background: rgba(0,0,0,0.5); padding: 15px; border-radius: 12px; margin-top: 10px; border-left: 5px solid var(--accent); display: flex; justify-content: space-between; align-items: center; }
        .ai-box { background: #000; color: #00ff9d; padding: 15px; height: 150px; overflow-y: auto; border-radius: 12px; font-family: 'Courier New', monospace; font-size: 13px; border: 1px solid var(--primary); margin-bottom: 10px; }
        .badge { padding: 4px 8px; border-radius: 6px; font-size: 10px; font-weight: bold; text-transform: uppercase; }
    </style>
</head>
<body>

<div class="header-logo">
    <img src="B1BCC237-7C89-4142-8131-6DA05C2A2C61 2.png" alt="Oficina Lisboa" class="main-logo">
</div>

<div id="loginBox" class="container">
    <div class="card active-section" style="text-align: center;">
        <i class="fas fa-user-shield" style="font-size: 3rem; color: var(--accent); margin-bottom: 15px;"></i>
        <h3>ACESSO RESTRITO</h3>
        <input id="user" placeholder="Nome de Usu√°rio">
        <input id="pass" type="password" placeholder="Senha de Acesso">
        <button class="btn-blue" onclick="login()"><i class="fas fa-sign-in-alt"></i> ENTRAR NO SISTEMA</button>
    </div>
</div>

<div id="dashboard" class="container" style="display:none">
    
    <div class="menu-grid">
        <div class="menu-item" onclick="show('sec-dash')"><i class="fas fa-home"></i><span>Painel</span></div>
        <div class="menu-item" onclick="show('sec-serv')"><i class="fas fa-tools"></i><span>Servi√ßo</span></div>
        <div class="menu-item" onclick="show('sec-hist')"><i class="fas fa-search"></i><span>Busca</span></div>
        <div class="menu-item" onclick="show('sec-estoque')"><i class="fas fa-box-open"></i><span>Estoque</span></div>
        <div class="menu-item" onclick="show('sec-caixa')"><i class="fas fa-wallet"></i><span>Caixa</span></div>
        <div class="menu-item" onclick="show('sec-precos')"><i class="fas fa-tags"></i><span>Tabela</span></div>
        <div class="menu-item" onclick="show('sec-forn')"><i class="fas fa-truck-loading"></i><span>Forn.</span></div>
        <div class="menu-item" onclick="show('sec-calc')"><i class="fas fa-percentage"></i><span>Taxas</span></div>
        <div class="menu-item" onclick="show('sec-agenda')"><i class="fas fa-calendar-check"></i><span>Retorno</span></div>
        <div class="menu-item" onclick="show('sec-compras')"><i class="fas fa-shopping-basket"></i><span>Compras</span></div>
        <div class="menu-item" onclick="show('sec-check')"><i class="fas fa-clipboard-list"></i><span>Avarias</span></div>
        <div class="menu-item" onclick="show('sec-ia')"><i class="fas fa-robot"></i><span>IA</span></div>
    </div>

    <div id="sec-dash" class="card">
        <h3><i class="fas fa-chart-bar"></i> Resumo Financeiro</h3>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:20px">
            <div style="background:#0d1f33; padding:15px; border-radius:12px; text-align:center; border-bottom: 3px solid var(--success)">
                <small>Entradas</small><br><b id="d-in" style="font-size:1.2rem; color:var(--success)">R$ 0</b>
            </div>
            <div style="background:#0d1f33; padding:15px; border-radius:12px; text-align:center; border-bottom: 3px solid var(--danger)">
                <small>Sa√≠das</small><br><b id="d-out" style="font-size:1.2rem; color:var(--danger)">R$ 0</b>
            </div>
        </div>
        <canvas id="graficoCanvas" height="180"></canvas>
        <button class="btn-del" style="margin-top:15px" onclick="fecharMes()">FECHAR M√äS / ZERAR</button>
    </div>

    <div id="sec-serv" class="card">
        <h3><i class="fas fa-plus-circle"></i> Registrar Servi√ßo</h3>
        <input id="sNome" placeholder="Nome do Cliente">
        <input id="sPlaca" placeholder="Placa ou Modelo da Moto">
        <input id="sCel" placeholder="WhatsApp (DDD + N√∫mero)">
        <input id="sServ" placeholder="Descri√ß√£o do Trabalho">
        <input id="sVal" type="number" placeholder="Valor do Servi√ßo R$">
        <select id="sStatus">
            <option value="Pendente">üü° Pendente</option>
            <option value="Fazendo">üîµ Em Manuten√ß√£o</option>
            <option value="Pronto">üü¢ Pronto para Entrega</option>
        </select>
        <button class="btn-add" onclick="addServico()"><i class="fas fa-save"></i> SALVAR SERVI√áO</button>
        <div class="btn-group">
            <button class="btn-wpp" onclick="zapServico()"><i class="fab fa-whatsapp"></i> AVISAR</button>
            <button class="btn-blue" onclick="pdfServico()"><i class="fas fa-file-pdf"></i> RECIBO</button>
        </div>
        <button onclick="limparForm(['sNome','sPlaca','sCel','sServ','sVal'])" style="background:transparent; color:#bbb">Limpar Tudo</button>
    </div>

    <div id="sec-hist" class="card">
        <h3><i class="fas fa-history"></i> Prontu√°rio Digital</h3>
        <input id="busca" placeholder="Digite a placa para buscar..." onkeyup="render()">
        <div id="list-hist"></div>
    </div>

    <div id="sec-estoque" class="card">
        <h3><i class="fas fa-boxes"></i> Controle de Pe√ßas</h3>
        <input id="eN" placeholder="Nome da Pe√ßa">
        <input id="eQ" type="number" placeholder="Quantidade">
        <button class="btn-add" onclick="addObj('estoque')">ADICIONAR PE√áA</button>
        <div id="list-estoque"></div>
    </div>

    <div id="sec-caixa" class="card">
        <h3><i class="fas fa-cash-register"></i> Fluxo de Caixa</h3>
        <input id="vR" type="number" placeholder="Valor R$">
        <div class="btn-group">
            <button class="btn-add" onclick="lancar('in')">ENTRADA (+)</button>
            <button class="btn-del" onclick="lancar('out')">SA√çDA (-)</button>
        </div>
    </div>

    <div id="sec-precos" class="card">
        <h3><i class="fas fa-list-ol"></i> Pre√ßos de Servi√ßos</h3>
        <input id="pN" placeholder="Ex: Troca de √ìleo">
        <input id="pV" placeholder="Valor Sugerido R$">
        <button class="btn-blue" onclick="addObj('precos')">CADASTRAR PRE√áO</button>
        <div id="list-precos"></div>
    </div>

    <div id="sec-forn" class="card">
        <h3><i class="fas fa-truck"></i> Meus Fornecedores</h3>
        <input id="fN" placeholder="Nome da Loja/Vendedor">
        <input id="fC" placeholder="Telefone de Contato">
        <button class="btn-blue" onclick="addObj('forn')">SALVAR FORNECEDOR</button>
        <div id="list-forn"></div>
    </div>

    <div id="sec-calc" class="card">
        <h3><i class="fas fa-calculator"></i> Calculadora de Cart√£o</h3>
        <input id="calcVal" type="number" placeholder="Quanto voc√™ quer receber?">
        <select id="calcMaq">
            <option value="1.05">D√©bito (5%)</option>
            <option value="1.12">Cr√©dito 1x (12%)</option>
            <option value="1.22">Cr√©dito 12x (22%)</option>
        </select>
        <button class="btn-add" onclick="calcular()">CALCULAR PRE√áO FINAL</button>
        <h2 id="calcRes" style="text-align:center; color:var(--success)"></h2>
    </div>

    <div id="sec-agenda" class="card">
        <h3><i class="fas fa-calendar-alt"></i> Agenda de Revis√£o</h3>
        <input id="agN" placeholder="Cliente">
        <input id="agD" type="date">
        <input id="agM" placeholder="Motivo (Ex: Pneu)">
        <button class="btn-add" onclick="addObj('agenda')">AGENDAR RETORNO</button>
        <div id="list-agenda"></div>
    </div>

    <div id="sec-compras" class="card">
        <h3><i class="fas fa-shopping-cart"></i> Lista de Compras</h3>
        <input id="cpI" placeholder="O que est√° faltando?">
        <button class="btn-add" onclick="addObj('compras')">ADD NA LISTA</button>
        <div id="list-compras"></div>
    </div>

    <div id="sec-check" class="card">
        <h3><i class="fas fa-clipboard-check"></i> Registro de Avarias</h3>
        <input id="avP" placeholder="Placa da Moto">
        <textarea id="avD" placeholder="Ex: Risco no tanque, retrovisor frouxo..."></textarea>
        <button class="btn-add" onclick="addObj('avarias')">SALVAR CHECK-LIST</button>
        <div id="list-avarias"></div>
    </div>

    <div id="sec-ia" class="card">
        <h3><i class="fas fa-robot"></i> Intelig√™ncia Lisboa</h3>
        <div class="ai-box" id="chat">> Pronto para an√°lise financeira...</div>
        <input id="msgIA" placeholder="Pergunte sobre seu lucro...">
        <button class="btn-blue" onclick="ia()">CONSULTAR IA</button>
        <button class="btn-backup" style="background:#f39c12; margin-top:20px" onclick="gerarBackup()">CRIAR BACKUP DOS DADOS</button>
        <textarea id="txtBackup" style="font-size:9px; height:50px; margin-top:5px" placeholder="C√≥digo de seguran√ßa..."></textarea>
        <button class="btn-blue" onclick="restaurarBackup()">RESTAURAR BACKUP</button>
    </div>

    <button onclick="location.reload()" class="btn-del" style="margin-top:30px; opacity:0.6">SAIR DO SISTEMA</button>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('lisboa_v12_final')) || { in: 0, out: 0, hist: [], estoque: [], precos: [], forn: [], agenda: [], compras: [], avarias: [] };
    let myChart;

    function save() { localStorage.setItem('lisboa_v12_final', JSON.stringify(db)); render(); }

    function login() {
        if(user.value === "dono" && pass.value === "1234") {
            document.getElementById('loginBox').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            show('sec-dash'); render();
        } else { alert("Acesso negado!"); }
    }

    function show(id) {
        document.querySelectorAll('.card').forEach(c => c.classList.remove('active-section'));
        document.getElementById(id).classList.add('active-section');
        window.scrollTo(0,0);
    }

    function calcular() {
        let res = parseFloat(calcVal.value) * parseFloat(calcMaq.value);
        document.getElementById('calcRes').innerText = "Cobrar: R$ " + res.toFixed(2);
    }

    function lancar(t) {
        let v = parseFloat(vR.value);
        if(v > 0) { db[t] += v; vR.value = ""; save(); }
    }

    function addServico() {
        let v = parseFloat(sVal.value);
        if(v > 0 && sNome.value) {
            db.in += v;
            db.hist.unshift({id: Date.now(), n: sNome.value, p: sPlaca.value.toUpperCase(), s: sServ.value, v: v, st: sStatus.value, d: new Date().toLocaleDateString(), z: sCel.value});
            save(); alert("Servi√ßo registrado!");
        }
    }

    function addObj(t) {
        if(t==='estoque') db.estoque.push({n: eN.value, v: eQ.value});
        if(t==='precos') db.precos.push({n: pN.value, v: pV.value});
        if(t==='forn') db.forn.push({n: fN.value, v: fC.value});
        if(t==='agenda') db.agenda.push({n: agN.value, d: agD.value, m: agM.value});
        if(t==='compras') db.compras.push({n: cpI.value});
        if(t==='avarias') db.avarias.push({p: avP.value, d: avD.value});
        save();
    }

    function excluir(t, i, v=0) {
        if(confirm("Deseja excluir este registro?")) {
            if(v > 0) db.in -= v;
            db[t].splice(i, 1); save();
        }
    }

    function fecharMes() {
        if(confirm("Zerar ganhos do gr√°fico? (O hist√≥rico n√£o ser√° apagado)")) {
            db.in = 0; db.out = 0; save();
        }
    }

    function render() {
        document.getElementById("d-in").innerText = "R$ " + db.in.toFixed(2);
        document.getElementById("d-out").innerText = "R$ " + db.out.toFixed(2);
        
        const ui = (t, el, template) => {
            document.getElementById(el).innerHTML = db[t].map((item, i) => `
                <div class="item-lista"><span>${template(item)}</span><i class="fas fa-trash" style="color:red" onclick="excluir('${t}',${i})"></i></div>
            `).join('');
        };

        ui('estoque', 'list-estoque', x => `${x.n} - <b>${x.v} un</b>`);
        ui('precos', 'list-precos', x => `${x.n}: <b>R$ ${x.v}</b>`);
        ui('forn', 'list-forn', x => `${x.n} (${x.v})`);
        ui('agenda', 'list-agenda', x => `${x.d} - ${x.n} (${x.m})`);
        ui('compras', 'list-compras', x => x.n);
        ui('avarias', 'list-avarias', x => `<b>${x.p}</b>: ${x.d}`);

        document.getElementById("list-hist").innerHTML = db.hist.filter(h => h.p.includes(busca.value.toUpperCase())).map((h, i) => `
            <div class="item-lista">
                <span><b>${h.p}</b> - ${h.n}<br><small>${h.s}</small></span>
                <div style="text-align:right">
                    <span class="badge" style="background:${h.st=='Pronto'?'#00ff9d':'#ff4b2b'}">${h.st}</span><br>
                    <b>R$ ${h.v}</b> <i class="fas fa-trash" style="color:red; margin-left:8px" onclick="excluir('hist',${i},${h.v})"></i>
                </div>
            </div>
        `).join('');

        const ctx = document.getElementById('graficoCanvas').getContext('2d');
        if(myChart) myChart.destroy();
        myChart = new Chart(ctx, { type: 'bar', data: { labels: ['ENTRADAS', 'SA√çDAS'], datasets: [{ data: [db.in, db.out], backgroundColor: ['#00ff9d', '#ff4b2b'], borderRadius: 10 }] }, options: { plugins: { legend: { display: false } } } });
    }

    function ia() {
        let r = "Lucro L√≠quido: R$ " + (db.in - db.out).toFixed(2);
        chat.innerHTML += `<div>> ${r}</div>`;
        msgIA.value = ""; chat.scrollTop = chat.scrollHeight;
    }

    function zapServico() { window.open(`https://api.whatsapp.com/send?phone=${sCel.value}&text=Ol√°! Sua moto est√° ${sStatus.value} na Oficina Lisboa. Valor: R$ ${sVal.value}`); }
    function pdfServico() { const { jsPDF } = window.jspdf; const doc = new jsPDF(); doc.text("OFICINA LISBOA - RECIBO", 10, 20); doc.text("Cliente: " + sNome.value, 10, 40); doc.text("Valor: R$ " + sVal.value, 10, 50); doc.save("recibo.pdf"); }
    function limparForm(ids) { ids.forEach(id => document.getElementById(id).value = ""); }
    function gerarBackup() { txtBackup.value = btoa(JSON.stringify(db)); alert("Backup Criado!"); }
    function restaurarBackup() { db = JSON.parse(atob(txtBackup.value)); save(); alert("Restaurado!"); }
</script>
</body>
</html>
