<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LISBOA PRO ELITE - GEST√ÉO TOTAL</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #1b4a9c; --accent: #00b4ff; --success: #00ff9d; --danger: #ff4b2b; --warning: #f39c12; --dark: #0a192f; --card: #112240; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--dark); color: white; padding-bottom: 50px; }
        .header-logo { text-align: center; padding: 15px; background: #112240; border-bottom: 3px solid var(--primary); }
        .main-logo { max-width: 140px; filter: drop-shadow(0 0 5px var(--accent)); }
        .container { padding: 10px; max-width: 850px; margin: auto; }
        
        /* Grid 12 Op√ß√µes */
        .menu-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 15px; }
        .menu-item { background: var(--card); padding: 12px 5px; border-radius: 12px; text-align: center; border: 1px solid var(--primary); cursor: pointer; transition: 0.2s; }
        .menu-item i { font-size: 1.3rem; color: var(--accent); margin-bottom: 5px; display: block; }
        .menu-item span { font-size: 0.6rem; font-weight: bold; text-transform: uppercase; display: block; }
        .menu-item:active { background: var(--primary); transform: scale(0.95); }

        .card { background: var(--card); padding: 20px; border-radius: 20px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.1); display: none; animation: fadeIn 0.3s; }
        .active-section { display: block !important; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .box-lucro { background: linear-gradient(135deg, #1b4a9c, #00ff9d); color: #000; padding: 15px; border-radius: 15px; text-align: center; margin-bottom: 15px; font-weight: bold; }
        
        input, select, textarea { background: #0d1f33; border: 1px solid #1e3a5a; color: white; padding: 12px; border-radius: 8px; width: 100%; box-sizing: border-box; margin: 5px 0; font-size: 16px; }
        button { padding: 12px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; width: 100%; margin: 5px 0; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-add { background: var(--success); color: #000; }
        .btn-blue { background: var(--primary); color: white; }
        .btn-del { background: var(--danger); color: white; }
        
        .item-lista { background: rgba(0,0,0,0.4); padding: 12px; border-radius: 10px; margin-top: 8px; border-left: 4px solid var(--accent); display: flex; justify-content: space-between; align-items: center; font-size: 13px; }
    </style>
</head>
<body>

<div class="header-logo">
    <img src="B1BCC237-7C89-4142-8131-6DA05C2A2C61 2.png" alt="Oficina Lisboa" class="main-logo">
</div>

<div id="loginBox" class="container">
    <div class="card active-section" style="text-align: center;">
        <i class="fas fa-lock" style="font-size: 2rem; color: var(--accent);"></i>
        <h3>LISBOA PRO ELITE</h3>
        <input id="pass" type="password" placeholder="Senha de Acesso">
        <button class="btn-blue" onclick="login()">ENTRAR NO PAINEL</button>
    </div>
</div>

<div id="dashboard" class="container" style="display:none">
    
    <div class="menu-grid">
        <div class="menu-item" onclick="show('sec-dash')"><i class="fas fa-chart-line"></i><span>Lucro</span></div>
        <div class="menu-item" onclick="show('sec-serv')"><i class="fas fa-motorcycle"></i><span>Servi√ßo</span></div>
        <div class="menu-item" onclick="show('sec-contas')"><i class="fas fa-money-bill-wave"></i><span>Contas</span></div>
        <div class="menu-item" onclick="show('sec-hist')"><i class="fas fa-search"></i><span>Busca</span></div>
        <div class="menu-item" onclick="show('sec-estoque')"><i class="fas fa-box"></i><span>Estoque</span></div>
        <div class="menu-item" onclick="show('sec-precos')"><i class="fas fa-tags"></i><span>Tabela</span></div>
        <div class="menu-item" onclick="show('sec-forn')"><i class="fas fa-truck"></i><span>Forn.</span></div>
        <div class="menu-item" onclick="show('sec-calc')"><i class="fas fa-calculator"></i><span>Taxas</span></div>
        <div class="menu-item" onclick="show('sec-agenda')"><i class="fas fa-calendar-alt"></i><span>Retorno</span></div>
        <div class="menu-item" onclick="show('sec-compras')"><i class="fas fa-shopping-cart"></i><span>Compras</span></div>
        <div class="menu-item" onclick="show('sec-check')"><i class="fas fa-clipboard-check"></i><span>Avarias</span></div>
        <div class="menu-item" onclick="show('sec-ia')"><i class="fas fa-robot"></i><span>IA/Backup</span></div>
    </div>

    <div id="sec-dash" class="card">
        <div class="box-lucro">SALDO REAL (LIMPO): <br><span id="d-lucro" style="font-size: 1.8rem;">R$ 0</span></div>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px;">
            <div style="background:#0d1f33; padding:10px; border-radius:10px; text-align:center"><small>M√£o de Obra</small><br><b id="d-bruto" style="color:var(--success)">0</b></div>
            <div style="background:#0d1f33; padding:10px; border-radius:10px; text-align:center"><small>Gasto Pe√ßas</small><br><b id="d-pecas" style="color:var(--warning)">0</b></div>
        </div>
        <canvas id="graficoFin" height="150" style="margin-top:15px"></canvas>
        <button class="btn-del" onclick="fecharMes()">ZERAR M√äS ATUAL</button>
    </div>

    <div id="sec-serv" class="card">
        <h3><i class="fas fa-tools"></i> Novo Servi√ßo</h3>
        <input id="sNome" placeholder="Cliente">
        <input id="sPlaca" placeholder="Placa">
        <input id="sCel" placeholder="Zap (Ex: 5511...)">
        <input id="sMao" type="number" placeholder="M√£o de Obra R$ (Seu lucro)">
        <input id="sPec" type="number" placeholder="Pe√ßas R$ (Custo)">
        <select id="sStatus">
            <option value="Pendente">üü° Pendente</option>
            <option value="Pronto">üü¢ Pronto</option>
        </select>
        <button class="btn-add" onclick="addServico()">SALVAR NO CAIXA</button>
        <div style="display:flex; gap:5px">
            <button class="btn-blue" onclick="zapServico()"><i class="fab fa-whatsapp"></i></button>
            <button class="btn-blue" onclick="pdfServico()"><i class="fas fa-file-pdf"></i></button>
        </div>
    </div>

    <div id="sec-contas" class="card">
        <h3><i class="fas fa-hand-holding-usd"></i> Pagar Contas</h3>
        <input id="ctN" placeholder="Ex: Luz, Aluguel, Almo√ßo">
        <input id="ctV" type="number" placeholder="Valor R$">
        <button class="btn-del" onclick="addConta()">PAGAR E DESCONTAR</button>
        <div id="list-contas"></div>
    </div>

    <div id="sec-hist" class="card">
        <h3><i class="fas fa-history"></i> Hist√≥rico</h3>
        <input id="busca" placeholder="Buscar placa..." onkeyup="render()">
        <div id="list-hist"></div>
    </div>

    <div id="sec-estoque" class="card">
        <h3><i class="fas fa-boxes"></i> Estoque</h3>
        <input id="eN" placeholder="Pe√ßa"><input id="eQ" type="number" placeholder="Qtd">
        <button class="btn-add" onclick="addObj('estoque')">ADD</button>
        <div id="list-estoque"></div>
    </div>

    <div id="sec-precos" class="card">
        <h3><i class="fas fa-tags"></i> Tabela</h3>
        <input id="pN" placeholder="Servi√ßo"><input id="pV" placeholder="R$">
        <button class="btn-blue" onclick="addObj('precos')">ADD</button>
        <div id="list-precos"></div>
    </div>

    <div id="sec-forn" class="card">
        <h3><i class="fas fa-truck"></i> Fornecedores</h3>
        <input id="fN" placeholder="Nome"><input id="fC" placeholder="Zap">
        <button class="btn-blue" onclick="addObj('forn')">ADD</button>
        <div id="list-forn"></div>
    </div>

    <div id="sec-calc" class="card">
        <h3><i class="fas fa-calculator"></i> Calculadora Cart√£o</h3>
        <input id="calcV" type="number" placeholder="Valor que quer receber">
        <button class="btn-blue" onclick="alert('Cobrar: R$ ' + (calcV.value * 1.12).toFixed(2))">SIMULAR (Taxa 12%)</button>
    </div>

    <div id="sec-agenda" class="card">
        <h3><i class="fas fa-calendar-alt"></i> Agenda de Retorno</h3>
        <input id="agN" placeholder="Cliente"><input id="agD" type="date">
        <button class="btn-add" onclick="addObj('agenda')">AGENDAR</button>
        <div id="list-agenda"></div>
    </div>

    <div id="sec-compras" class="card">
        <h3><i class="fas fa-shopping-basket"></i> Lista de Compras</h3>
        <input id="cpI" placeholder="O que falta?">
        <button class="btn-add" onclick="addObj('compras')">ADD</button>
        <div id="list-compras"></div>
    </div>

    <div id="sec-check" class="card">
        <h3><i class="fas fa-clipboard-list"></i> Check-list Avarias</h3>
        <input id="avP" placeholder="Placa"><textarea id="avD" placeholder="Riscos, amassados..."></textarea>
        <button class="btn-add" onclick="addObj('avarias')">SALVAR</button>
        <div id="list-avarias"></div>
    </div>

    <div id="sec-ia" class="card">
        <h3><i class="fas fa-robot"></i> Analista IA</h3>
        <div id="chatIA" style="background:#000; color:#00ff9d; padding:10px; border-radius:10px; font-family:monospace; margin-bottom:10px"></div>
        <button class="btn-blue" onclick="analisarIA()">ANALISAR MEU LUCRO</button>
        <hr style="opacity:0.2; margin:20px 0">
        <h3><i class="fas fa-database"></i> Backup</h3>
        <button onclick="gerarBack()">GERAR C√ìDIGO</button>
        <textarea id="txtBack" style="font-size:8px"></textarea>
    </div>

    <button onclick="location.reload()" class="btn-del" style="margin-top:20px; opacity:0.6">SAIR</button>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('lisboa_total_v15')) || { mao: 0, pecas_total: 0, contas_total: 0, hist: [], estoque: [], precos: [], forn: [], agenda: [], compras: [], avarias: [], contas: [] };
    let chart;

    function save() { localStorage.setItem('lisboa_total_v15', JSON.stringify(db)); render(); }

    function login() { if(pass.value === "1234") { loginBox.style.display='none'; dashboard.style.display='block'; show('sec-dash'); render(); } }

    function show(id) { document.querySelectorAll('.card').forEach(c => c.classList.remove('active-section')); document.getElementById(id).classList.add('active-section'); window.scrollTo(0,0); }

    function addServico() {
        let m = parseFloat(sMao.value) || 0; let p = parseFloat(sPec.value) || 0;
        if(m+p > 0) {
            db.mao += m; db.pecas_total += p;
            db.hist.unshift({n: sNome.value, p: sPlaca.value.toUpperCase(), v: (m+p), st: sStatus.value, z: sCel.value});
            sMao.value=""; sPec.value=""; sNome.value=""; save(); alert("Salvo!");
        }
    }

    function addConta() {
        let v = parseFloat(ctV.value) || 0;
        if(v > 0) { db.contas_total += v; db.contas.unshift({n: ctN.value, v: v}); save(); }
    }

    function addObj(t) {
        if(t==='estoque') db.estoque.push({n: eN.value, v: eQ.value});
        if(t==='precos') db.precos.push({n: pN.value, v: pV.value});
        if(t==='forn') db.forn.push({n: fN.value, v: fC.value});
        if(t==='agenda') db.agenda.push({n: agN.value, d: agD.value});
        if(t==='compras') db.compras.push({n: cpI.value});
        if(t==='avarias') db.avarias.push({p: avP.value, d: avD.value});
        save();
    }

    function excluir(t, i) { if(confirm("Excluir?")) { db[t].splice(i, 1); save(); } }
    function fecharMes() { if(confirm("Zerar ganhos do m√™s?")) { db.mao=0; db.pecas_total=0; db.contas_total=0; save(); } }

    function render() {
        let lucro = db.mao - db.contas_total;
        document.getElementById("d-lucro").innerText = "R$ " + lucro.toFixed(2);
        document.getElementById("d-bruto").innerText = "R$ " + db.mao.toFixed(2);
        document.getElementById("d-pecas").innerText = "R$ " + db.pecas_total.toFixed(2);

        document.getElementById("list-hist").innerHTML = db.hist.filter(h => h.p.includes(busca.value.toUpperCase())).map((h, i) => `<div class="item-lista"><span>${h.p} - ${h.n}</span><b>R$ ${h.v}</b></div>`).join('');
        document.getElementById("list-contas").innerHTML = db.contas.map(c => `<div class="item-lista"><span>${c.n}</span><b style="color:red">- R$ ${c.v}</b></div>`).join('');
        document.getElementById("list-estoque").innerHTML = db.estoque.map(e => `<div class="item-lista"><span>${e.n}</span><b>${e.v} un</b></div>`).join('');

        const ctx = document.getElementById('graficoFin').getContext('2d');
        if(chart) chart.destroy();
        chart = new Chart(ctx, { type: 'doughnut', data: { labels: ['Meu Lucro', 'Custo Pe√ßas', 'Contas'], datasets: [{ data: [lucro > 0 ? lucro : 0, db.pecas_total, db.contas_total], backgroundColor: ['#00ff9d', '#f39c12', '#ff4b2b'] }] } });
    }

    function analisarIA() {
        let lucro = db.mao - db.contas_total;
        let msg = lucro <= 0 ? "PAI, ALERTA: Suas contas est√£o maiores que seu lucro. Pare de tirar dinheiro do caixa!" : "LUCRO BOM: Voc√™ tem R$ " + lucro.toFixed(2) + " limpos hoje.";
        document.getElementById("chatIA").innerText = "> " + msg;
    }

    function zapServico() { window.open(`https://api.whatsapp.com/send?phone=${sCel.value}&text=Sua moto est√° pronta na Oficina Lisboa!`); }
    function pdfServico() { const { jsPDF } = window.jspdf; const doc = new jsPDF(); doc.text("RECIBO OFICINA LISBOA", 10, 20); doc.save("recibo.pdf"); }
    function gerarBack() { txtBack.value = btoa(JSON.stringify(db)); }
</script>
</body>
</html>
