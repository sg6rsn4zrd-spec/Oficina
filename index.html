<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LISBOA PRO - SISTEMA INTEGRAL</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #1b4a9c; --accent: #00b4ff; --success: #00ff9d; --danger: #ff4b2b; --dark: #0a192f; --card: #112240; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--dark); color: white; padding-bottom: 30px; }
        .header-logo { text-align: center; padding: 15px; background: #112240; border-bottom: 3px solid var(--primary); }
        .main-logo { max-width: 180px; }
        .container { padding: 15px; max-width: 800px; margin: auto; }
        
        /* Menu de 8 OpÃ§Ãµes em Grid */
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
        .menu-item { background: var(--card); padding: 15px; border-radius: 15px; text-align: center; border: 1px solid var(--primary); cursor: pointer; transition: 0.3s; }
        .menu-item i { font-size: 1.5rem; color: var(--accent); margin-bottom: 8px; display: block; }
        .menu-item span { font-size: 0.85rem; font-weight: bold; text-transform: uppercase; }
        .menu-item:active { transform: scale(0.95); background: var(--primary); }

        .card { background: var(--card); padding: 20px; border-radius: 15px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.1); display: none; }
        .active-section { display: block !important; }

        input, select { background: #0d1f33; border: 1px solid #1e3a5a; color: white; padding: 12px; border-radius: 8px; width: 100%; box-sizing: border-box; margin: 5px 0; font-size: 16px; }
        button { padding: 12px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; width: 100%; margin: 5px 0; }
        .btn-add { background: var(--success); color: var(--dark); }
        .btn-blue { background: var(--primary); color: white; }
        .btn-del { background: var(--danger); color: white; }

        .item-lista { background: rgba(0,0,0,0.4); padding: 12px; border-radius: 10px; margin-top: 8px; border-left: 4px solid var(--accent); display: flex; justify-content: space-between; align-items: center; }
        .ai-box { background: black; color: #00ff9d; padding: 10px; height: 100px; overflow-y: auto; border-radius: 10px; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>

<div class="header-logo">
    <img src="B1BCC237-7C89-4142-8131-6DA05C2A2C61 2.png" alt="Oficina Lisboa" class="main-logo">
</div>

<div id="loginBox" class="container">
    <div class="card active-section" style="text-align: center;">
        <h3>SISTEMA LISBOA PRO</h3>
        <input id="user" placeholder="UsuÃ¡rio">
        <input id="pass" type="password" placeholder="Senha">
        <button class="btn-blue" onclick="login()">ACESSAR PAINEL</button>
    </div>
</div>

<div id="dashboard" class="container" style="display:none">
    
    <div class="menu-grid">
        <div class="menu-item" onclick="show('sec-dash')"><i class="fas fa-chart-pie"></i><span>Dashboard</span></div>
        <div class="menu-item" onclick="show('sec-serv')"><i class="fas fa-motorcycle"></i><span>Novo ServiÃ§o</span></div>
        <div class="menu-item" onclick="show('sec-estoque')"><i class="fas fa-boxes"></i><span>Estoque</span></div>
        <div class="menu-item" onclick="show('sec-caixa')"><i class="fas fa-cash-register"></i><span>Caixa RÃ¡pido</span></div>
        <div class="menu-item" onclick="show('sec-precos')"><i class="fas fa-tags"></i><span>PreÃ§os</span></div>
        <div class="menu-item" onclick="show('sec-forn')"><i class="fas fa-truck"></i><span>Fornecedores</span></div>
        <div class="menu-item" onclick="show('sec-hist')"><i class="fas fa-history"></i><span>HistÃ³rico</span></div>
        <div class="menu-item" onclick="show('sec-ia')"><i class="fas fa-robot"></i><span>IA Lisboa</span></div>
    </div>

    <div id="sec-dash" class="card">
        <h3>ðŸ“Š Resumo Financeiro</h3>
        <div style="display:flex; gap:10px; margin-bottom:10px">
            <div style="flex:1; background:#0d1f33; padding:10px; border-radius:10px">Ganhos: <b id="d-in" style="color:var(--success)">0</b></div>
            <div style="flex:1; background:#0d1f33; padding:10px; border-radius:10px">Gastos: <b id="d-out" style="color:var(--danger)">0</b></div>
        </div>
        <canvas id="graficoCanvas" height="150"></canvas>
    </div>

    <div id="sec-serv" class="card">
        <h3>ðŸ”§ Registrar Atendimento</h3>
        <input id="sNome" placeholder="Nome do Cliente">
        <input id="sPlaca" placeholder="Placa/Modelo">
        <input id="sServ" placeholder="ServiÃ§o">
        <input id="sVal" type="number" placeholder="Valor R$">
        <button class="btn-add" onclick="addServico()">Salvar e Somar no Caixa</button>
    </div>

    <div id="sec-estoque" class="card">
        <h3>ðŸ“¦ Controle de PeÃ§as</h3>
        <input id="eN" placeholder="Nome da PeÃ§a">
        <input id="eQ" type="number" placeholder="Quantidade">
        <button class="btn-add" onclick="addObj('estoque')">Adicionar ao Estoque</button>
        <div id="list-estoque"></div>
    </div>

    <div id="sec-caixa" class="card">
        <h3>ðŸ’° LanÃ§amento Avulso</h3>
        <input id="vR" type="number" placeholder="Valor R$">
        <button class="btn-add" onclick="lancar('in')">Entrada (+)</button>
        <button class="btn-del" onclick="lancar('out')">Gasto (-)</button>
    </div>

    <div id="sec-precos" class="card">
        <h3>ðŸ“‹ Tabela de PreÃ§os</h3>
        <input id="pN" placeholder="ServiÃ§o">
        <input id="pV" placeholder="PreÃ§o Sugerido">
        <button class="btn-blue" onclick="addObj('precos')">Salvar na Tabela</button>
        <div id="list-precos"></div>
    </div>

    <div id="sec-forn" class="card">
        <h3>ðŸš› Fornecedores</h3>
        <input id="fN" placeholder="Nome/Loja">
        <input id="fC" placeholder="Contato/Zap">
        <button class="btn-blue" onclick="addObj('forn')">Salvar Contato</button>
        <div id="list-forn"></div>
    </div>

    <div id="sec-hist" class="card">
        <h3>ðŸ“‚ ProntuÃ¡rio de Clientes</h3>
        <input id="busca" placeholder="Buscar por placa..." onkeyup="render()">
        <div id="list-hist"></div>
    </div>

    <div id="sec-ia" class="card">
        <h3>ðŸ¤– IA Lisboa</h3>
        <div class="ai-box" id="chat">> Sistema pronto.</div>
        <input id="msgIA" placeholder="Pergunte sobre lucros...">
        <button class="btn-blue" onclick="ia()">Enviar</button>
    </div>

    <button onclick="location.reload()" class="btn-del" style="opacity: 0.7;">VOLTAR AO LOGIN</button>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('lisboa_final_v10')) || { in: 0, out: 0, hist: [], estoque: [], precos: [], forn: [] };
    let myChart;

    function save() { localStorage.setItem('lisboa_final_v10', JSON.stringify(db)); render(); }

    function login() {
        if(user.value === "dono" && pass.value === "1234") {
            document.getElementById('loginBox').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            show('sec-dash'); render();
        } else { alert("Acesso negado"); }
    }

    function show(id) {
        document.querySelectorAll('.card').forEach(c => c.classList.remove('active-section'));
        document.getElementById(id).classList.add('active-section');
    }

    function lancar(t) {
        let v = parseFloat(vR.value);
        if(v > 0) { db[t] += v; vR.value = ""; save(); }
    }

    function addServico() {
        let v = parseFloat(sVal.value);
        if(v > 0 && sNome.value) {
            db.in += v;
            db.hist.unshift({n: sNome.value, p: sPlaca.value.toUpperCase(), s: sServ.value, v: v});
            sNome.value = ""; sPlaca.value = ""; sServ.value = ""; sVal.value = "";
            save(); alert("ServiÃ§o Salvo!");
        }
    }

    function addObj(t) {
        if(t==='estoque') db.estoque.push({n: eN.value, v: eQ.value});
        if(t==='precos') db.precos.push({n: pN.value, v: pV.value});
        if(t==='forn') db.forn.push({n: fN.value, v: fC.value});
        save();
    }

    function excluir(t, i, v=0) {
        if(confirm("Excluir?")) { db.in -= v; db[t].splice(i, 1); save(); }
    }

    function render() {
        document.getElementById("d-in").innerText = "R$ " + db.in.toFixed(2);
        document.getElementById("d-out").innerText = "R$ " + db.out.toFixed(2);

        document.getElementById("list-hist").innerHTML = db.hist.filter(h => h.p.includes(busca.value.toUpperCase())).map((h, i) => `
            <div class="item-lista"><span>${h.p} - ${h.n}</span><b>R$ ${h.v} <i class="fas fa-trash" onclick="excluir('hist',${i},${h.v})" style="color:red;margin-left:10px"></i></b></div>`).join('');
        
        document.getElementById("list-estoque").innerHTML = db.estoque.map((e, i) => `<div class="item-lista">${e.n} <b>${e.v} un</b> <i class="fas fa-times" onclick="excluir('estoque',${i})"></i></div>`).join('');
        document.getElementById("list-precos").innerHTML = db.precos.map((p, i) => `<div class="item-lista">${p.n} <b>R$ ${p.v}</b> <i class="fas fa-times" onclick="excluir('precos',${i})"></i></div>`).join('');
        document.getElementById("list-forn").innerHTML = db.forn.map((f, i) => `<div class="item-lista">${f.n} <b>${f.v}</b> <i class="fas fa-times" onclick="excluir('forn',${i})"></i></div>`).join('');

        const ctx = document.getElementById('graficoCanvas').getContext('2d');
        if(myChart) myChart.destroy();
        myChart = new Chart(ctx, { type: 'pie', data: { labels: ['Entradas', 'SaÃ­das'], datasets: [{ data: [db.in, db.out], backgroundColor: ['#00ff9d', '#ff4b2b'] }] } });
    }

    function ia() {
        let r = "Lucro total: R$ " + (db.in - db.out).toFixed(2);
        chat.innerHTML += `<div><b>IA:</b> ${r}</div>`;
        msgIA.value = "";
    }
</script>
</body>
</html>

