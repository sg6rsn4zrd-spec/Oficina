<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LISBOA GEST√ÉO</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* CORES S√ìLIDAS E PROFISSIONAIS */
        :root {
            --azul-escuro: #0a2342;
            --azul-real: #1e60ff;
            --fundo: #f4f6f9;
            --branco: #ffffff;
            --texto: #2d3748;
        }

        body { 
            margin: 0; font-family: 'Segoe UI', Roboto, sans-serif; 
            background: var(--fundo); color: var(--texto); padding-bottom: 90px;
        }

        /* LOGIN (CORRIGIDO) */
        #login-screen {
            position: fixed; inset: 0; background: var(--azul-escuro);
            display: flex; align-items: center; justify-content: center; z-index: 9999;
        }
        .login-card {
            background: var(--branco); padding: 30px; border-radius: 20px;
            width: 85%; max-width: 320px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        /* CABE√áALHO */
        header { background: var(--azul-escuro); color: white; padding: 20px; text-align: center; font-weight: bold; }
        
        .container { padding: 15px; max-width: 500px; margin: auto; }

        /* SE√á√ïES (O MOTOR DO APP) */
        .page { display: none; animation: simpleFade 0.2s; }
        .page.active { display: block !important; }
        @keyframes simpleFade { from { opacity: 0; } to { opacity: 1; } }

        /* CARDS */
        .card { 
            background: var(--branco); border-radius: 15px; padding: 20px; 
            margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 1px solid #e2e8f0;
        }

        /* GRID DAS 12 OP√á√ïES */
        .menu-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 20px 0; }
        .menu-item {
            background: var(--branco); border: 1px solid #cbd5e1; padding: 12px 2px;
            border-radius: 12px; text-align: center; cursor: pointer; transition: 0.1s;
        }
        .menu-item:active { background: #edf2f7; transform: scale(0.95); }
        .menu-item i { color: var(--azul-real); font-size: 1.2rem; display: block; margin-bottom: 5px; }
        .menu-item span { font-size: 0.6rem; font-weight: bold; text-transform: uppercase; color: var(--azul-escuro); }

        /* FORMUL√ÅRIOS */
        input, textarea { 
            width: 100%; padding: 15px; margin: 10px 0; border: 1px solid #cbd5e1; 
            border-radius: 10px; font-size: 16px; box-sizing: border-box; background: #fff;
        }
        .btn-acao { 
            width: 100%; padding: 16px; background: var(--azul-real); color: white; 
            border: none; border-radius: 12px; font-weight: bold; font-size: 16px; cursor: pointer;
        }
        .btn-pdf { background: #4a5568; margin-top: 10px; }

        /* BARRA DE NAVEGA√á√ÉO */
        .nav-inferior {
            position: fixed; bottom: 0; left: 0; right: 0; background: var(--branco);
            display: flex; justify-content: space-around; padding: 12px 0 25px 0;
            border-top: 2px solid #e2e8f0; z-index: 1000;
        }
        .nav-link { color: #94a3b8; text-align: center; flex: 1; text-decoration: none; cursor: pointer; }
        .nav-link.active { color: var(--azul-real); }
        .nav-link span { display: block; font-size: 0.65rem; font-weight: bold; }

        .item-lista { background: white; padding: 15px; border-radius: 12px; margin-bottom: 10px; border-left: 5px solid var(--azul-real); display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>

<div id="login-screen">
    <div class="login-card">
        <h2 style="color: var(--azul-escuro); margin-bottom: 20px;">LISBOA PRO</h2>
        <input id="senha-input" type="password" placeholder="Digite a Senha" style="text-align:center">
        <button class="btn-acao" onclick="autenticar()">ENTRAR NO SISTEMA</button>
    </div>
</div>

<div id="app-principal" style="display:none">
    <header>OFICINA LISBOA - GEST√ÉO</header>

    <div class="container">
        
        <div id="p-home" class="page active">
            <div class="card">
                <small style="font-weight: bold; opacity: 0.7;">LUCRO ESTIMADO</small>
                <h1 id="total-lucro" style="color: #2f855a; margin: 10px 0;">R$ 0,00</h1>
                <div style="display: flex; justify-content: space-between; font-size: 0.8rem;">
                    <span>Entradas: <b id="total-mao" style="color:blue">R$ 0</b></span>
                    <span>Sa√≠das: <b id="total-gastos" style="color:red">R$ 0</b></span>
                </div>
            </div>

            <div class="menu-grid">
                <div class="menu-item" onclick="mudarPara('p-oleo')"><i class="fas fa-oil-can"></i><span>√ìleo</span></div>
                <div class="menu-item" onclick="mudarPara('p-estoque')"><i class="fas fa-box"></i><span>Estoque</span></div>
                <div class="menu-item" onclick="mudarPara('p-tabela')"><i class="fas fa-tags"></i><span>Tabela</span></div>
                <div class="menu-item" onclick="mudarPara('p-agenda')"><i class="fas fa-calendar-alt"></i><span>Agenda</span></div>
                <div class="menu-item" onclick="mudarPara('p-ia')"><i class="fas fa-brain"></i><span>Analista</span></div>
                <div class="menu-item" onclick="mudarPara('p-compras')"><i class="fas fa-cart-arrow-down"></i><span>Compras</span></div>
                <div class="menu-item" onclick="mudarPara('p-check')"><i class="fas fa-clipboard-check"></i><span>Check</span></div>
                <div class="menu-item" onclick="mudarPara('p-taxas')"><i class="fas fa-percent"></i><span>Taxas</span></div>
                <div class="menu-item" onclick="mudarPara('p-clientes')"><i class="fas fa-user-friends"></i><span>Clientes</span></div>
                <div class="menu-item" onclick="mudarPara('p-pecas')"><i class="fas fa-cogs"></i><span>Pe√ßas</span></div>
                <div class="menu-item" onclick="mudarPara('p-alertas')"><i class="fas fa-bell"></i><span>Alertas</span></div>
                <div class="menu-item" onclick="fazerBackup()"><i class="fas fa-save"></i><span>Backup</span></div>
            </div>
            <canvas id="graficoHome" height="150"></canvas>
        </div>

        <div id="p-novo" class="page">
            <div class="card">
                <h3>üî® Nova Ordem de Servi√ßo</h3>
                <input id="in-cliente" placeholder="Nome do Cliente">
                <input id="in-placa" placeholder="Placa da Moto" style="text-transform: uppercase;">
                <input id="in-mao" type="number" placeholder="Sua M√£o de Obra (R$)">
                <input id="in-pecas" type="number" placeholder="Valor das Pe√ßas (R$)">
                <textarea id="in-obs" placeholder="O que foi feito?"></textarea>
                <button class="btn-acao" onclick="salvarNovoServico()">SALVAR NO CAIXA</button>
                <button class="btn-acao btn-pdf" onclick="gerarRecibo()">GERAR RECIBO PDF</button>
            </div>
        </div>

        <div id="p-busca" class="page">
            <h3>üîç Hist√≥rico de Servi√ßos</h3>
            <input id="campo-busca" placeholder="Digite a placa..." onkeyup="atualizarListas()">
            <div id="lista-historico"></div>
        </div>

        <div id="p-caixa" class="page">
            <div class="card">
                <h3>üí∏ Registrar Gasto/Sa√≠da</h3>
                <input id="g-desc" placeholder="O que voc√™ pagou?">
                <input id="g-valor" type="number" placeholder="Valor R$">
                <button class="btn-acao" style="background: #e53e3e;" onclick="salvarSaida()">REGISTRAR PAGAMENTO</button>
            </div>
            <div id="lista-gastos"></div>
        </div>

        <div id="p-oleo" class="page"><h3>üõ¢Ô∏è Controle de √ìleo</h3><button class="btn-acao" onclick="mudarPara('p-home')">Voltar</button></div>
        <div id="p-estoque" class="page"><h3>üì¶ Estoque</h3><button class="btn-acao" onclick="mudarPara('p-home')">Voltar</button></div>
        <div id="p-tabela" class="page"><h3>üìã Tabela de Pre√ßos</h3><button class="btn-acao" onclick="mudarPara('p-home')">Voltar</button></div>
        <div id="p-agenda" class="page"><h3>üìÖ Agenda</h3><button class="btn-acao" onclick="mudarPara('p-home')">Voltar</button></div>
        <div id="p-ia" class="page"><h3>ü§ñ Analista IA</h3><button class="btn-acao" onclick="mudarPara('p-home')">Voltar</button></div>
        <div id="p-compras" class="page"><h3>üõí Lista de Compras</h3><button class="btn-acao" onclick="mudarPara('p-home')">Voltar</button></div>
        <div id="p-check" class="page"><h3>üìã Check-list</h3><button class="btn-acao" onclick="mudarPara('p-home')">Voltar</button></div>
        <div id="p-taxas" class="page"><h3>üí≥ Calculadora de Taxas</h3><button class="btn-acao" onclick="mudarPara('p-home')">Voltar</button></div>
        <div id="p-clientes" class="page"><h3>üë• Meus Clientes</h3><button class="btn-acao" onclick="mudarPara('p-home')">Voltar</button></div>
        <div id="p-pecas" class="page"><h3>üîß Pe√ßas Pendentes</h3><button class="btn-acao" onclick="mudarPara('p-home')">Voltar</button></div>
        <div id="p-alertas" class="page"><h3>üîî Avisos do Sistema</h3><button class="btn-acao" onclick="mudarPara('p-home')">Voltar</button></div>

    </div>

    <div class="nav-inferior">
        <div class="nav-link active" id="btn-home" onclick="mudarPara('p-home')"><i class="fas fa-home"></i><span>In√≠cio</span></div>
        <div class="nav-link" id="btn-novo" onclick="mudarPara('p-novo')"><i class="fas fa-plus-circle"></i><span>Novo</span></div>
        <div class="nav-link" id="btn-busca" onclick="mudarPara('p-busca')"><i class="fas fa-search"></i><span>Hist√≥rico</span></div>
        <div class="nav-link" id="btn-caixa" onclick="mudarPara('p-caixa')"><i class="fas fa-wallet"></i><span>Caixa</span></div>
    </div>
</div>

<script>
    // BANCO DE DADOS
    let dados = JSON.parse(localStorage.getItem('lisboa_data_v10')) || { entrada: 0, saida: 0, servicos: [], gastos: [] };
    let chartInstance = null;

    function autenticar() {
        if(document.getElementById('senha-input').value === '1234') {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app-principal').style.display = 'block';
            atualizarListas();
        } else {
            alert("Senha incorreta!");
        }
    }

    // FUN√á√ÉO DE NAVEGA√á√ÉO (BLINDADA)
    function mudarPara(idPagina) {
        // 1. Esconde todas as p√°ginas
        const paginas = document.getElementsByClassName('page');
        for (let p of paginas) {
            p.classList.remove('active');
        }
        // 2. Mostra a p√°gina correta
        document.getElementById(idPagina).classList.add('active');

        // 3. Atualiza os bot√µes da nav bar
        const botoes = document.getElementsByClassName('nav-link');
        for (let b of botoes) { b.classList.remove('active'); }
        
        if(idPagina === 'p-home') document.getElementById('btn-home').classList.add('active');
        if(idPagina === 'p-novo') document.getElementById('btn-novo').classList.add('active');
        if(idPagina === 'p-busca') document.getElementById('btn-busca').classList.add('active');
        if(idPagina === 'p-caixa') document.getElementById('btn-caixa').classList.add('active');
        
        window.scrollTo(0,0);
    }

    function salvarNovoServico() {
        const mao = parseFloat(document.getElementById('in-mao').value) || 0;
        const pec = parseFloat(document.getElementById('in-pecas').value) || 0;
        const nome = document.getElementById('in-cliente').value;
        const placa = document.getElementById('in-placa').value.toUpperCase();

        if(!nome || !mao) return alert("Preencha o Nome e a M√£o de Obra!");

        dados.entrada += mao;
        dados.servicos.unshift({
            nome, placa, total: mao + pec, data: new Date().toLocaleDateString(), obs: document.getElementById('in-obs').value
        });

        salvarERenderizar();
        mudarPara('p-home');
        
        // Limpa campos
        document.getElementById('in-cliente').value = '';
        document.getElementById('in-placa').value = '';
        document.getElementById('in-mao').value = '';
        document.getElementById('in-pecas').value = '';
        document.getElementById('in-obs').value = '';
    }

    function salvarSaida() {
        const valor = parseFloat(document.getElementById('g-valor').value) || 0;
        const desc = document.getElementById('g-desc').value;

        if(!valor || !desc) return alert("Preencha o valor e a descri√ß√£o!");

        dados.saida += valor;
        dados.gastos.unshift({ desc, valor, data: new Date().toLocaleDateString() });

        document.getElementById('g-desc').value = '';
        document.getElementById('g-valor').value = '';
        salvarERenderizar();
    }

    function salvarERenderizar() {
        localStorage.setItem('lisboa_data_v10', JSON.stringify(dados));
        atualizarListas();
    }

    function atualizarListas() {
        const lucroTotal = dados.entrada - dados.saida;
        document.getElementById('total-lucro').innerText = "R$ " + lucroTotal.toLocaleString('pt-BR', {minimumFractionDigits: 2});
        document.getElementById('total-mao').innerText = "R$ " + dados.entrada.toLocaleString('pt-BR');
        document.getElementById('total-gastos').innerText = "R$ " + dados.saida.toLocaleString('pt-BR');

        // Renderizar Hist√≥rico (Busca)
        const busca = document.getElementById('campo-busca').value.toUpperCase();
        document.getElementById('lista-historico').innerHTML = dados.servicos
            .filter(s => s.placa.includes(busca))
            .map(s => `
                <div class="item-lista">
                    <span><b>${s.placa}</b><br><small>${s.nome}</small></span>
                    <b>R$ ${s.total.toFixed(2)}</b>
                </div>
            `).join('');

        // Renderizar Gastos
        document.getElementById('lista-gastos').innerHTML = dados.gastos.map(g => `
            <div class="item-lista">
                <span>${g.desc}<br><small>${g.data}</small></span>
                <b style="color:red">- R$ ${g.valor.toFixed(2)}</b>
            </div>
        `).join('');

        renderGrafico(lucroTotal);
    }

    function renderGrafico(lucro) {
        const ctx = document.getElementById('graficoHome').getContext('2d');
        if(chartInstance) chartInstance.destroy();
        chartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['In√≠cio', 'Hoje'],
                datasets: [{
                    label: 'Lucro Acumulado',
                    data: [0, lucro],
                    borderColor: '#1e60ff',
                    backgroundColor: 'rgba(30,96,255,0.1)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: { plugins: { legend: { display: false } }, scales: { y: { display: false }, x: { display: false } } }
        });
    }

    function gerarRecibo() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.setFontSize(20);
        doc.text("RECIBO - OFICINA LISBOA", 20, 20);
        doc.setFontSize(14);
        doc.text("Cliente: " + document.getElementById('in-cliente').value, 20, 40);
        doc.text("Placa: " + document.getElementById('in-placa').value.toUpperCase(), 20, 50);
        doc.text("Valor Total: R$ " + (parseFloat(document.getElementById('in-mao').value||0) + parseFloat(document.getElementById('in-pecas').value||0)).toFixed(2), 20, 60);
        doc.text("Data: " + new Date().toLocaleDateString(), 20, 70);
        doc.save("Recibo_Lisboa.pdf");
    }

    function fazerBackup() {
        const str = btoa(JSON.stringify(dados));
        alert("C√ìDIGO DE BACKUP (COPIE E GUARDE):\n\n" + str);
    }
</script>
</body>
</html>
