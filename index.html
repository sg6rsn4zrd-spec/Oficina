<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Oficina Lisboa PRO</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  background: #0b1c2c;
  color: white;
}

/* LOGIN */
#loginPage {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100vh;
  background: linear-gradient(135deg, #001f3f, #0055ff);
}

#loginPage input {
  padding: 12px;
  font-size: 18px;
  border-radius: 6px;
  border: none;
  margin-top: 10px;
}

#loginPage button {
  padding: 12px 30px;
  font-size: 18px;
  margin-top: 15px;
  border: none;
  border-radius: 6px;
  background: black;
  color: white;
  cursor: pointer;
}

#loginPage button:hover {
  background: #ffcc00;
  color: black;
}

/* MAIN */
#mainPage {
  display: none;
  padding: 10px;
}

/* BOTÃ•ES MENU */
.menu-btn {
  padding: 10px;
  margin: 5px;
  background: #0055ff;
  color: white;
  border: none;
  border-radius: 5px;
  font-size: 14px;
}
.menu-btn:hover {
  background: #ffcc00;
  color: black;
}

/* ALERTAS */
.alert-red { background:red; padding:5px; border-radius:5px;}
.alert-yellow { background:orange; padding:5px; border-radius:5px;}
.alert-green { background:green; padding:5px; border-radius:5px;}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginPage">
  <h1>ğŸ”’ Oficina Lisboa - Acesso Restrito</h1>
  <input id="pass" type="password" placeholder="Digite a senha">
  <button onclick="login()">Entrar no Painel</button>
</div>

<!-- PAINEL PRINCIPAL -->
<div id="mainPage">

<h2>ğŸš€ Painel Oficina Lisboa PRO</h2>

<button class="menu-btn" onclick="showSection('dashboard')">ğŸ“Š Dashboard</button>
<button class="menu-btn" onclick="showSection('servicos')">ğŸ”§ ServiÃ§os</button>
<button class="menu-btn" onclick="showSection('contas')">ğŸ’¸ Contas</button>
<button class="menu-btn" onclick="showSection('estoque')">ğŸ“¦ Estoque</button>
<button class="menu-btn" onclick="showSection('agenda')">ğŸ“… Agenda</button>
<button class="menu-btn" onclick="showSection('clientes')">ğŸ‘¤ Clientes</button>
<button class="menu-btn" onclick="showSection('backup')">ğŸ’¾ Backup</button>

<hr>
<!-- SEÃ‡Ã•ES -->
<div id="dashboard" class="section">
  <h3>ğŸ“Š Dashboard Financeiro</h3>
  <p id="totalLucro">Lucro: R$ 0</p>
  <p id="totalDespesas">Despesas: R$ 0</p>
  <p id="totalServicos">ServiÃ§os: 0</p>

  <canvas id="graficoLucro" width="300" height="200"></canvas>
</div>

<div id="servicos" class="section" style="display:none;">
  <h3>ğŸ”§ Registrar ServiÃ§o</h3>
  <input id="cliente" placeholder="Cliente"><br>
  <input id="placa" placeholder="Placa"><br>
  <input id="valorServico" type="number" placeholder="Valor R$"><br>
  <button onclick="addServico()">Salvar ServiÃ§o</button>
  <ul id="listaServicos"></ul>
</div>

<div id="contas" class="section" style="display:none;">
  <h3>ğŸ’¸ Registrar Conta / Despesa</h3>
  <input id="descConta" placeholder="DescriÃ§Ã£o"><br>
  <input id="valorConta" type="number" placeholder="Valor R$"><br>

  <select id="tipoPagamento">
    <option>Dinheiro</option>
    <option>PIX</option>
    <option>DÃ©bito</option>
    <option>CrÃ©dito</option>
  </select><br>

  <button onclick="addConta()">Salvar Conta</button>
  <ul id="listaContas"></ul>
</div>

<style>
.section {padding:10px;}
input, select {padding:8px;margin:5px;border-radius:5px;border:none;}
button {padding:8px;margin:5px;border-radius:5px;border:none;background:#0055ff;color:white;}
button:hover {background:#ffcc00;color:black;}
</style>

<script>
/* LOGIN */
function login(){
  let senha = document.getElementById("pass").value;
  if(senha === "2026"){
    document.getElementById("loginPage").style.display="none";
    document.getElementById("mainPage").style.display="block";
  } else {
    alert("Senha errada!");
  }
}

/* MENU */
function showSection(id){
  document.querySelectorAll(".section").forEach(s=>s.style.display="none");
  document.getElementById(id).style.display="block";
}

/* DADOS */
let servicos = JSON.parse(localStorage.getItem("servicos")) || [];
let contas = JSON.parse(localStorage.getItem("contas")) || [];

/* SERVIÃ‡OS */
function addServico(){
  let c = cliente.value;
  let p = placa.value;
  let v = Number(valorServico.value);
  servicos.push({c,p,v});
  localStorage.setItem("servicos", JSON.stringify(servicos));
  atualizar();
}

function listarServicos(){
  listaServicos.innerHTML="";
  servicos.forEach(s=>{
    listaServicos.innerHTML += `<li>${s.c} - ${s.p} - R$ ${s.v}</li>`;
  });
}

/* CONTAS */
function addConta(){
  let d = descConta.value;
  let v = Number(valorConta.value);
  let t = tipoPagamento.value;
  contas.push({d,v,t});
  localStorage.setItem("contas", JSON.stringify(contas));
  atualizar();
}

function listarContas(){
  listaContas.innerHTML="";
  contas.forEach(c=>{
    listaContas.innerHTML += `<li>${c.d} - R$ ${c.v} (${c.t})</li>`;
  });
}

/* DASHBOARD */
function atualizar(){
  listarServicos();
  listarContas();

  let totalS = servicos.reduce((a,b)=>a+b.v,0);
  let totalC = contas.reduce((a,b)=>a+b.v,0);

  totalLucro.innerText = "Lucro: R$ " + (totalS-totalC);
  totalDespesas.innerText = "Despesas: R$ " + totalC;
  totalServicos.innerText = "ServiÃ§os: " + servicos.length;

  desenharGrafico(totalS,totalC);
}

/* GRÃFICO SIMPLES (SEM BUG SAFARI) */
function desenharGrafico(lucro,desp){
  let c = document.getElementById("graficoLucro");
  let ctx = c.getContext("2d");
  ctx.clearRect(0,0,300,200);

  ctx.fillStyle="green";
  ctx.fillRect(50,200-lucro/10,50,lucro/10);

  ctx.fillStyle="red";
  ctx.fillRect(150,200-desp/10,50,desp/10);
}

atualizar();
</script>
<!-- ESTOQUE -->
<div id="estoque" class="section" style="display:none;">
  <h3>ğŸ“¦ Controle de Estoque</h3>
  <input id="peca" placeholder="PeÃ§a">
  <input id="qtd" type="number" placeholder="Quantidade">
  <button onclick="addEstoque()">Adicionar</button>
  <ul id="listaEstoque"></ul>
</div>

<!-- AGENDA -->
<div id="agenda" class="section" style="display:none;">
  <h3>ğŸ“… Agenda</h3>
  <input id="nomeAgenda" placeholder="Cliente">
  <input id="dataAgenda" type="date">
  <button onclick="addAgenda()">Agendar</button>
  <ul id="listaAgenda"></ul>
</div>

<!-- CLIENTES -->
<div id="clientes" class="section" style="display:none;">
  <h3>ğŸ‘¤ Clientes</h3>
  <input id="nomeCliente" placeholder="Nome">
  <input id="foneCliente" placeholder="WhatsApp">
  <button onclick="addCliente()">Salvar Cliente</button>
  <ul id="listaClientes"></ul>
</div>

<!-- BACKUP -->
<div id="backup" class="section" style="display:none;">
  <h3>ğŸ’¾ Backup</h3>
  <button onclick="exportarDados()">Exportar CSV</button>
  <p id="statusBackup"></p>
</div>

<script>
/* ===== DADOS ===== */
let estoque = JSON.parse(localStorage.getItem("estoque")) || [];
let agenda = JSON.parse(localStorage.getItem("agenda")) || [];
let clientes = JSON.parse(localStorage.getItem("clientes")) || [];

/* ===== ESTOQUE ===== */
function addEstoque(){
  let p = peca.value;
  let q = Number(qtd.value);
  estoque.push({p,q});
  localStorage.setItem("estoque", JSON.stringify(estoque));
  listarEstoque();
}

function listarEstoque(){
  listaEstoque.innerHTML="";
  estoque.forEach(e=>{
    let alerta = e.q < 3 ? "âš ï¸ BAIXO" : "";
    listaEstoque.innerHTML += `<li>${e.p} - ${e.q} ${alerta}</li>`;
    if(e.q < 3) popup("Estoque baixo: " + e.p);
  });
}

/* ===== AGENDA ===== */
function addAgenda(){
  let n = nomeAgenda.value;
  let d = dataAgenda.value;
  agenda.push({n,d});
  localStorage.setItem("agenda", JSON.stringify(agenda));
  listarAgenda();
}

function listarAgenda(){
  listaAgenda.innerHTML="";
  agenda.forEach(a=>{
    listaAgenda.innerHTML += `<li>${a.n} - ${a.d} 
    <button onclick="abrirWhats('${a.n}')">WhatsApp</button></li>`;
  });
}

/* ===== CLIENTES ===== */
function addCliente(){
  let n = nomeCliente.value;
  let f = foneCliente.value;
  clientes.push({n,f});
  localStorage.setItem("clientes", JSON.stringify(clientes));
  listarClientes();
}

function listarClientes(){
  listaClientes.innerHTML="";
  clientes.forEach(c=>{
    listaClientes.innerHTML += `<li>${c.n} - ${c.f}</li>`;
  });
}

/* ===== WHATSAPP AUTOMÃTICO ===== */
function abrirWhats(nome){
  let msg = encodeURIComponent("OlÃ¡, sua revisÃ£o da moto estÃ¡ agendada! Qualquer dÃºvida Ã© sÃ³ chamar. Oficina Lisboa.");
  window.open("https://wa.me/?text="+msg);
}

/* ===== POPUP ALERTA ===== */
function popup(msg){
  let div = document.createElement("div");
  div.innerHTML = msg;
  div.style.position="fixed";
  div.style.bottom="20px";
  div.style.right="20px";
  div.style.background="red";
  div.style.color="white";
  div.style.padding="10px";
  div.style.borderRadius="8px";
  document.body.appendChild(div);
  setTimeout(()=>div.remove(),4000);
}

/* ===== BACKUP CSV ===== */
function exportarDados(){
  let dados = {
    servicos, contas, estoque, agenda, clientes
  };
  let csv = JSON.stringify(dados);
  let blob = new Blob([csv], {type:"text/plain"});
  let a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "backup_oficina.txt";
  a.click();
  statusBackup.innerText="Backup exportado!";
}

/* ===== ATUALIZAÃ‡ÃƒO GERAL ===== */
listarEstoque();
listarAgenda();
listarClientes();
</script>
<!-- DASHBOARD -->
<div id="dashboard" class="section" style="display:none;">
  <h2>ğŸ“Š Dashboard Profissional</h2>

  <div class="cards">
    <div class="card">ğŸ’° Lucro: R$ <span id="lucroTotal">0</span></div>
    <div class="card">ğŸ“ˆ ServiÃ§os: <span id="totalServicos">0</span></div>
    <div class="card">ğŸ“¦ PeÃ§as Estoque: <span id="totalEstoque">0</span></div>
  </div>

  <h3>ğŸ¯ Metas Mensais</h3>
  <input id="metaLucro" type="number" placeholder="Meta de lucro">
  <button onclick="salvarMeta()">Salvar Meta</button>
  <p>Progresso: <span id="progressoMeta">0%</span></p>

  <canvas id="graficoLucro" width="300" height="200"></canvas>
</div>

<style>
.cards{
 display:flex; gap:10px; flex-wrap:wrap;
}
.card{
 background:#0d6efd;
 color:white;
 padding:15px;
 border-radius:12px;
 flex:1;
 min-width:120px;
 text-align:center;
 font-weight:bold;
 box-shadow:0 5px 10px rgba(0,0,0,0.2);
 transition:0.3s;
}
.card:hover{transform:scale(1.05);}

button{
 background:#0d6efd;
 color:white;
 border:none;
 padding:10px;
 border-radius:8px;
 cursor:pointer;
 transition:0.2s;
}
button:hover{background:#084298;}
.section{padding:15px;}
</style>

<script>
/* ===== METAS ===== */
let meta = localStorage.getItem("metaLucro") || 0;

function salvarMeta(){
  meta = Number(metaLucro.value);
  localStorage.setItem("metaLucro", meta);
  atualizarDashboard();
}

/* ===== DASHBOARD ===== */
function atualizarDashboard(){
  let lucro = servicos.reduce((s,v)=>s+Number(v.valor||0),0);
  lucroTotal.innerText = lucro;
  totalServicos.innerText = servicos.length;
  totalEstoque.innerText = estoque.length;

  if(meta>0){
    let p = Math.min((lucro/meta)*100,100).toFixed(1);
    progressoMeta.innerText = p+"%";
  }
  desenharGrafico();
}

/* ===== GRÃFICO PROFISSIONAL (CANVAS) ===== */
function desenharGrafico(){
  let canvas = document.getElementById("graficoLucro");
  let ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,300,200);

  // dados por serviÃ§o
  let dados = servicos.map(s=>Number(s.valor||0));
  let max = Math.max(...dados,10);

  ctx.fillStyle="#0d6efd";
  dados.forEach((v,i)=>{
    let h = (v/max)*150;
    ctx.fillRect(20+i*40,180-h,30,h);
  });

  ctx.fillStyle="black";
  ctx.fillText("Lucro por ServiÃ§o",80,10);
}

/* ===== ALERTAS URGENTES ===== */
function verificarAlertas(){
  contas.forEach(c=>{
    if(new Date(c.data) < new Date()){
      popup("Conta VENCIDA: "+c.nome);
    }
  });

  estoque.forEach(e=>{
    if(e.q < 3){
      popup("Estoque baixo: "+e.p);
    }
  });
}

/* ===== BOTÃƒO DE MENU ===== */
function abrir(sec){
  document.querySelectorAll(".section").forEach(s=>s.style.display="none");
  document.getElementById(sec).style.display="block";
}

/* ATUALIZAÃ‡ÃƒO GERAL */
atualizarDashboard();
verificarAlertas();
</script>

<!-- MENU -->
<div class="menu">
  <button onclick="abrir('dashboard')">ğŸ“Š Dashboard</button>
  <button onclick="abrir('estoque')">ğŸ“¦ Estoque</button>
  <button onclick="abrir('agenda')">ğŸ“… Agenda</button>
  <button onclick="abrir('clientes')">ğŸ‘¤ Clientes</button>
  <button onclick="abrir('backup')">ğŸ’¾ Backup</button>
</div>

<style>
.menu{
 position:fixed;
 bottom:0;
 left:0;
 right:0;
 background:white;
 display:flex;
 justify-content:space-around;
 padding:10px;
 box-shadow:0 -2px 10px rgba(0,0,0,0.2);
}
.menu button{
 flex:1;
 margin:2px;
 font-size:12px;
}
</style>

</body>
</html>
