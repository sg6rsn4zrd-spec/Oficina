<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LISBOA ÉLITE - V6</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Estilo Sólido - Sem transparências que causam bugs */
        body { 
            margin: 0; font-family: Arial, sans-serif; 
            background: #f0f2f5; color: #1a1a1a; padding-bottom: 80px;
        }

        /* LOGIN */
        #login-screen {
            position: fixed; inset: 0; background: #0a2e5c;
            display: flex; align-items: center; justify-content: center; z-index: 1000;
        }
        .login-box {
            background: white; padding: 30px; border-radius: 15px;
            width: 80%; max-width: 300px; text-align: center;
        }

        /* HEADER */
        .header { background: #0a2e5c; color: white; padding: 20px; text-align: center; }
        .logo-img { width: 70px; border-radius: 50%; border: 2px solid white; }

        .container { padding: 15px; max-width: 450px; margin: auto; }

        /* SEÇÕES - Lógica simples de display */
        .section { display: none; }
        .active { display: block !important; }

        /* CARDS */
        .card { 
            background: white; border-radius: 12px; padding: 20px; 
            margin-bottom: 15px; border: 1px solid #ddd; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* GRID 12 OPÇÕES */
        .grid-menu { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 15px 0; }
        .grid-item {
            background: #fff; border: 1px solid #0a2e5c; padding: 12px 2px;
            border-radius: 10px; text-align: center; cursor: pointer;
        }
        .grid-item i { color: #0a2e5c; font-size: 1.2rem; display: block; margin-bottom: 4px; }
        .grid-item span { font-size: 0.6rem; font-weight: bold; text-transform: uppercase; }

        /* INPUTS E BOTÕES */
        input, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ccc; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        .btn { width: 100%; padding: 15px; background: #0a2e5c; color: white; border: none; border-radius: 8px; font-weight: bold; font-size: 16px; }
        .btn-pdf { background: #555; margin-top: 10px; }

        /* NAV BAR */
        .nav-bar {
            position: fixed; bottom: 0; left: 0; right: 0; background: white;
            display: flex; justify-content: space-around; padding: 10px 0 20px 0;
            border-top: 2px solid #0a2e5c;
        }
        .nav-btn { color: #888; text-align: center; flex: 1; cursor: pointer; }
        .nav-btn.active { color: #0a2e5c; }
        .nav-btn span { display: block; font-size: 0.6rem; }

        .item-hist { background: white; padding: 10px; border-radius: 8px; margin-bottom: 8px; border-left: 5px solid #0a2e5c; display: flex; justify-content: space-between; }
    </style>
</head>
<body>

<div id="login-screen">
    <div class="login-box">
        <h2 style="color:#0a2e5c">LISBOA ÉLITE</h2>
        <input id="pass" type="password" placeholder="Senha" style="text-align:center">
        <button class="btn" onclick="fLogin()">ENTRAR</button>
    </div>
</div>

<div id="app" style="display:none">
    <div class="header">
        <img src="B1BCC237-7C89-4142-8131-6DA05C2A2C61 2.png" class="logo-img">
        <div style="margin-top:5px; font-weight:bold; letter-spacing:1px;">LISBOA GESTÃO</div>
    </div>

    <div class="container">
        
        <div id="sec-home" class="section active">
            <div class="card">
                <small>LUCRO LÍQUIDO</small>
                <h2 id="res-lucro" style="color: green; margin: 5px 0;">R$ 0,00</h2>
                <div style="font-size: 12px; display: flex; justify-content: space-between;">
                    <span>Ganhos: <b id="res-mao" style="color:blue">R$ 0</b></span>
                    <span>Saídas: <b id="res-contas" style="color:red">R$ 0</b></span>
                </div>
            </div>

            <div class="grid-menu">
                <div class="grid-item" onclick="go('sec-oleo')"><i class="fas fa-oil-can"></i><span>Óleo</span></div>
                <div class="grid-item" onclick="go('sec-estoque')"><i class="fas fa-box"></i><span>Estoque</span></div>
                <div class="grid-item" onclick="go('sec-tabela')"><i class="fas fa-tags"></i><span>Tabela</span></div>
                <div class="grid-item" onclick="go('sec-agenda')"><i class="fas fa-calendar"></i><span>Agenda</span></div>
                <div class="grid-item" onclick="go('sec-ia')"><i class="fas fa-brain"></i><span>Analista</span></div>
                <div class="grid-item" onclick="go('sec-compras')"><i class="fas fa-shopping-cart"></i><span>Compras</span></div>
                <div class="grid-item" onclick="go('sec-check')"><i class="fas fa-check-double"></i><span>Check</span></div>
                <div class="grid-item" onclick="go('sec-taxa')"><i class="fas fa-percent"></i><span>Taxas</span></div>
                <div class="grid-item" onclick="go('sec-cli')"><i class="fas fa-user-friends"></i><span>Clientes</span></div>
                <div class="grid-item" onclick="go('sec-pecas')"><i class="fas fa-cogs"></i><span>Peças</span></div>
                <div class="grid-item" onclick="go('sec-aviso')"><i class="fas fa-bell"></i><span>Avisos</span></div>
                <div class="grid-item" onclick="fBackup()"><i class="fas fa-database"></i><span>Backup</span></div>
            </div>
            <canvas id="graficoHome" height="150"></canvas>
        </div>

        <div id="sec-add" class="section">
            <div class="card">
                <h3>Novo Serviço</h3>
                <input id="sNome" placeholder="Nome do Cliente">
                <input id="sPlaca" placeholder="Placa" style="text-transform:uppercase">
                <input id="sMao" type="number" placeholder="Mão de Obra (R$)">
                <input id="sPec" type="number" placeholder="Custo das Peças (R$)">
                <textarea id="sObs" placeholder="Descrição"></textarea>
                <button class="btn" onclick="fSaveS()">SALVAR NO CAIXA</button>
                <button class="btn btn-pdf" onclick="fPdf()">GERAR PDF</button>
            </div>
        </div>

        <div id="sec-hist" class="section">
            <h3>Histórico</h3>
            <input id="q" placeholder="Buscar placa..." onkeyup="render()">
            <div id="render-hist"></div>
        </div>

        <div id="sec-cash" class="section">
            <div class="card">
                <h3>Pagar Conta</h3>
                <input id="cDesc" placeholder="Descrição">
                <input id="cVal" type="number" placeholder="Valor R$">
                <button class="btn" style="background:red" onclick="fSaveC()">SALVAR GASTO</button>
            </div>
            <div id="render-cash"></div>
        </div>

        <div id="sec-oleo" class="section"><h3>Óleo</h3><button class="btn" onclick="go('sec-home')">Voltar</button></div>
        <div id="sec-estoque" class="section"><h3>Estoque</h3><button class="btn" onclick="go('sec-home')">Voltar</button></div>
        <div id="sec-tabela" class="section"><h3>Tabela</h3><button class="btn" onclick="go('sec-home')">Voltar</button></div>
        <div id="sec-agenda" class="section"><h3>Agenda</h3><button class="btn" onclick="go('sec-home')">Voltar</button></div>
        <div id="sec-ia" class="section"><h3>IA</h3><button class="btn" onclick="go('sec-home')">Voltar</button></div>
        <div id="sec-compras" class="section"><h3>Compras</h3><button class="btn" onclick="go('sec-home')">Voltar</button></div>
        <div id="sec-check" class="section"><h3>Check</h3><button class="btn" onclick="go('sec-home')">Voltar</button></div>
        <div id="sec-taxa" class="section"><h3>Taxas</h3><button class="btn" onclick="go('sec-home')">Voltar</button></div>
        <div id="sec-cli" class="section"><h3>Clientes</h3><button class="btn" onclick="go('sec-home')">Voltar</button></div>
        <div id="sec-pecas" class="section"><h3>Peças</h3><button class="btn" onclick="go('sec-home')">Voltar</button></div>
        <div id="sec-aviso" class="section"><h3>Avisos</h3><button class="btn" onclick="go('sec-home')">Voltar</button></div>

    </div>

    <div class="nav-bar">
        <div class="nav-btn active" id="n-home" onclick="go('sec-home')"><i class="fas fa-home"></i><span>Home</span></div>
        <div class="nav-btn" id="n-add" onclick="go('sec-add')"><i class="fas fa-plus-circle"></i><span>Novo</span></div>
        <div class="nav-btn" id="n-hist" onclick="go('sec-hist')"><i class="fas fa-search"></i><span>Busca</span></div>
        <div class="nav-btn" id="n-cash" onclick="go('sec-cash')"><i class="fas fa-wallet"></i><span>Gastos</span></div>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('lisboa_v6')) || { mao:0, contas:0, servicos:[], despesas:[] };
    let ctx = document.getElementById('graficoHome').getContext('2d');
    let chart;

    function fLogin() {
        if(document.getElementById('pass').value === '1234') {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            render();
        } else { alert("Erro!"); }
    }

    function go(id) {
        // Esconde tudo
        let sections = document.getElementsByClassName('section');
        for(let s of sections) { s.style.display = 'none'; }
        // Mostra a certa
        document.getElementById(id).style.display = 'block';
        
        // Ativa ícone
        let btns = document.getElementsByClassName('nav-btn');
        for(let b of btns) { b.classList.remove('active'); }
        if(id === 'sec-home') document.getElementById('n-home').classList.add('active');
        if(id === 'sec-add') document.getElementById('n-add').classList.add('active');
        if(id === 'sec-hist') document.getElementById('n-hist').classList.add('active');
        if(id === 'sec-cash') document.getElementById('n-cash').classList.add('active');
        window.scrollTo(0,0);
    }

    function fSaveS() {
        let m = parseFloat(sMao.value) || 0;
        let p = parseFloat(sPec.value) || 0;
        if(!m || !sNome.value) return alert("Preencha!");
        db.mao += m;
        db.servicos.unshift({ n: sNome.value, p: sPlaca.value.toUpperCase(), v: m+p, d: new Date().toLocaleDateString() });
        localStorage.setItem('lisboa_v6', JSON.stringify(db));
        sNome.value=''; sPlaca.value=''; sMao.value=''; sPec.value='';
        render(); go('sec-home');
    }

    function fSaveC() {
        let v = parseFloat(cVal.value) || 0; if(!v) return;
        db.contas += v;
        db.despesas.unshift({ n: cDesc.value, v: v, d: new Date().toLocaleDateString() });
        localStorage.setItem('lisboa_v6', JSON.stringify(db));
        cDesc.value=''; cVal.value='';
        render();
    }

    function fPdf() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.text("RECIBO LISBOA", 10, 10);
        doc.text("Cliente: " + sNome.value, 10, 20);
        doc.text("Total: R$ " + (parseFloat(sMao.value||0) + parseFloat(sPec.value||0)).toFixed(2), 10, 30);
        doc.save("recibo.pdf");
    }

    function fBackup() { alert(btoa(JSON.stringify(db))); }

    function render() {
        let lucro = db.mao - db.contas;
        document.getElementById('res-lucro').innerText = "R$ " + lucro.toFixed(2);
        document.getElementById('res-mao').innerText = "R$ " + db.mao.toFixed(2);
        document.getElementById('res-contas').innerText = "R$ " + db.contas.toFixed(2);

        document.getElementById('render-hist').innerHTML = db.servicos.filter(s => s.p.includes(q.value.toUpperCase())).map(s => `
            <div class="item-hist"><span><b>${s.p}</b> - ${s.n}</span><b>R$ ${s.v.toFixed(2)}</b></div>
        `).join('');

        document.getElementById('render-cash').innerHTML = db.despesas.map(d => `
            <div class="item-hist"><span>${d.n}</span><b style="color:red">- R$ ${d.v.toFixed(2)}</b></div>
        `).join('');

        if(chart) chart.destroy();
        chart = new Chart(ctx, { type:'line', data:{ labels:['','','',''], datasets:[{data:[0,lucro], borderColor:'blue', tension:0.4}] }, options:{plugins:{legend:{display:false}}, scales:{y:{display:false},x:{display:false}}}});
    }

    render();
</script>
</body>
</html>
